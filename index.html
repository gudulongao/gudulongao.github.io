<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="小磊砸的布劳格">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="小磊砸的布劳格">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="小磊砸的布劳格">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>小磊砸的布劳格</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">小磊砸的布劳格</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/14/redblacktree/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小磊砸">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小磊砸的布劳格">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/14/redblacktree/" itemprop="url">红黑树</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-14T23:02:25+08:00">
                2018-11-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/数据结构/" itemprop="url" rel="index">
                    <span itemprop="name">数据结构</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/11/14/redblacktree/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/11/14/redblacktree/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="意义"><a href="#意义" class="headerlink" title="意义"></a>意义</h1><p>二叉搜索树，能够提供较好的查找，插入以及删除的效率。但是当插入的数据都是有序的，这会导致整个二叉搜索树退化为链表。当查找数据的时候由原来的二分查找变成了循环遍历。这种效率降低是因为树不够平衡导致的。红黑树就是对所有的节点增加红黑两种颜色，同时节点直接保持一种颜色的准则，在插入，删除等操作的同时也要维持这个准则，这样红黑树能够在处理排序数据时也能保证树的平衡，能够提供较好的查找效率。</p>
<h1 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h1><ul>
<li>所有节点要么是红色，要么是黑色</li>
<li>根节点必须是黑色</li>
<li>所有叶子节点的路径中不能有连续的红色节点（红色节点的子节点必须是黑色，反之不一定）</li>
<li>所有叶子节点的路径中黑色个数相同（黑色高度一致）</li>
</ul>
<h1 id="左旋"><a href="#左旋" class="headerlink" title="左旋"></a>左旋</h1><p><img src="/2018/11/14/redblacktree/leftretato.png" alt="左旋"></p>
<p>如图所示。左旋会将当前节点的右节点作为后继节点，当前节点作为后继节点的左子树。</p>
<p><img src="/2018/11/14/redblacktree/redblacktree-1.png" alt="红黑树-1"></p>
<h1 id="右旋"><a href="#右旋" class="headerlink" title="右旋"></a>右旋</h1><p><img src="/2018/11/14/redblacktree/rightretato.png" alt="右旋"></p>
<p>如图所示，右旋会将当亲节点的左子节点为后继节点，当前节点作为后继节点的右子树。</p>
<p><img src="/2018/11/14/redblacktree/redblacktree-2.png" alt="红黑树-2"></p>
<h1 id="插入"><a href="#插入" class="headerlink" title="插入"></a>插入</h1><p>插入节点逻辑比较复杂。因为要保证插入新节点后整个红黑树还能够保持红黑树的定义。<br>我们默认新插入的节点都是红色的，因为新节点是红色的代价最小。当节点是黑色是一定会使得黑色高度发生变化。而当新节点是红色，当父节点是黑色，则不违背定义，但如果父节点是红色，我们可以通过很小的代价来修正。</p>
<h2 id="修正"><a href="#修正" class="headerlink" title="修正"></a>修正</h2><h3 id="父节点为黑色"><a href="#父节点为黑色" class="headerlink" title="父节点为黑色"></a>父节点为黑色</h3><h3 id="父节点为红色，叔叔节点为黑色"><a href="#父节点为红色，叔叔节点为黑色" class="headerlink" title="父节点为红色，叔叔节点为黑色"></a>父节点为红色，叔叔节点为黑色</h3><h4 id="父节点是左子节点，新节点为左子节点"><a href="#父节点是左子节点，新节点为左子节点" class="headerlink" title="父节点是左子节点，新节点为左子节点"></a>父节点是左子节点，新节点为左子节点</h4><h4 id="父节点是左子节点，新节点是右子节点"><a href="#父节点是左子节点，新节点是右子节点" class="headerlink" title="父节点是左子节点，新节点是右子节点"></a>父节点是左子节点，新节点是右子节点</h4><h4 id="父节点是右子节点，新节点是左子节点"><a href="#父节点是右子节点，新节点是左子节点" class="headerlink" title="父节点是右子节点，新节点是左子节点"></a>父节点是右子节点，新节点是左子节点</h4><h4 id="父节点是右子节点，新节点是右子节点"><a href="#父节点是右子节点，新节点是右子节点" class="headerlink" title="父节点是右子节点，新节点是右子节点"></a>父节点是右子节点，新节点是右子节点</h4><p>#参考资料</p>
<blockquote>
<p>红黑树图片：<a href="https://blog.csdn.net/qq_34173549/article/details/79636764" target="_blank" rel="noopener">https://blog.csdn.net/qq_34173549/article/details/79636764</a><br>红黑树代码：<a href="https://www.cnblogs.com/skywang12345/p/3624343.html" target="_blank" rel="noopener">https://www.cnblogs.com/skywang12345/p/3624343.html</a><br>红黑树代码：<a href="https://www.cnblogs.com/ysocean/p/8004211.html" target="_blank" rel="noopener">https://www.cnblogs.com/ysocean/p/8004211.html</a><br>红黑树的删除：<a href="https://blog.csdn.net/qq_37169817/article/details/78880110" target="_blank" rel="noopener">https://blog.csdn.net/qq_37169817/article/details/78880110</a></p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/07/binarytree/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小磊砸">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小磊砸的布劳格">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/07/binarytree/" itemprop="url">二叉树</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-07T22:26:49+08:00">
                2018-11-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/数据结构/" itemprop="url" rel="index">
                    <span itemprop="name">数据结构</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/11/07/binarytree/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/11/07/binarytree/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h1><ul>
<li>路径：从一个节点到另一个节点所经过的节点顺序集合。</li>
<li>根：最顶端的节点。从根节点到其他节点都有一条唯一确定的路径。或者说到其他节点都需要从根节点出发。</li>
<li>层：从根节点开始定义，根节点位于第一层。根的子节点为第二层。以此类推。</li>
<li>深度：从根节点到某节点的路径长度。<strong>根节点的深度为0</strong>。</li>
<li>高度：某节点到叶子节点的最大路径长度。<strong>叶子节点的高度为0</strong>。</li>
<li>宽度：各层的最大节点数。如图1所示，第3层节点数做多，即树的宽度为4。</li>
<li>二叉树：每个节点最多有两个子节点的树。</li>
<li>二叉搜索树：若二叉树的左子树不空，则左子树所有节点的值都小于右子树的所有节点的值。若有子树不空，则右子树所有节点的值都大于子它根节点的值。</li>
<li><strong>二叉树第n层最多有2^(n-1)个节点。</strong></li>
<li><strong>二叉树第n层最多共有（2^n）-1个节点。</strong></li>
<li><strong>二叉树查找的时间复杂度是O(logn),底数为2。</strong></li>
</ul>
<p><img src="/2018/11/07/binarytree/tree-1.png" alt="二叉树-1"></p>
<h1 id="遍历"><a href="#遍历" class="headerlink" title="遍历"></a>遍历</h1><h2 id="先序遍历"><a href="#先序遍历" class="headerlink" title="先序遍历"></a>先序遍历</h2><p><img src="/2018/11/07/binarytree/preiterator.png" alt="二叉树-2"></p>
<h2 id="中序遍历"><a href="#中序遍历" class="headerlink" title="中序遍历"></a>中序遍历</h2><p><img src="/2018/11/07/binarytree/miditerator.png" alt="二叉树-3"></p>
<h2 id="后序遍历"><a href="#后序遍历" class="headerlink" title="后序遍历"></a>后序遍历</h2><p><img src="/2018/11/07/binarytree/postiterator.png" alt="二叉树-4"></p>
<h2 id="层序遍历"><a href="#层序遍历" class="headerlink" title="层序遍历"></a>层序遍历</h2><p><img src="/2018/11/07/binarytree/leveliterator.png" alt="二叉树-5"></p>
<p>层序遍历需要注意以下，因为遍历的时候先都是按照先左后右的顺序向下逐级遍历，故才有队列的方式来缓存当前根节点的子节点。</p>
<h1 id="插入"><a href="#插入" class="headerlink" title="插入"></a>插入</h1><p><img src="/2018/11/07/binarytree/insert.png" alt="二叉树-6"></p>
<p>插入的时候需要满足二叉搜索树的性质，即左子树的所有节点均小于右子树的所有节点，故需要从根节点开始，与待插入的数据进行比较，小于根节点的从左子树找，大于等于根节点的从右子树找。直到找到一个符合新值的叶子节点位置。</p>
<h1 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h1><p><img src="/2018/11/07/binarytree/delete.png" alt="二叉树-7"></p>
<p>删除操作首先需要查找到目标节点，删除目标节点肯定会涉及到目标节点的父级节点，以及目标节点是父级节点的子节点类型（左子节点还是右子节点），所以在查询的过程中需要一并获取这些数据。之后需要根据目标节点的类型来进行删除。需要考虑目标节点是否有子节点、目标节点有一个子节点以及目标节点有两个子节点这三种场景来考虑。</p>
<h2 id="删除叶子"><a href="#删除叶子" class="headerlink" title="删除叶子"></a>删除叶子</h2><p><img src="/2018/11/07/binarytree/delete-3.png" alt="二叉树-10"></p>
<p><img src="/2018/11/07/binarytree/delete-1.png" alt="二叉树-8"></p>
<p>当目标节点没有子节点时（叶子），只需要将目标节点的父节点对应的子节点清空即可。即如果目标节点是父节点的左子树则清空父节点的左子节点。反之同反。</p>
<h2 id="目标节点有一个子树"><a href="#目标节点有一个子树" class="headerlink" title="目标节点有一个子树"></a>目标节点有一个子树</h2><p><img src="/2018/11/07/binarytree/delete-4.png" alt="二叉树-11"></p>
<p><img src="/2018/11/07/binarytree/delete-2.png" alt="二叉树-9"></p>
<p>当目标节点有一个子节点时，需要将父级节点的对应子节点指向目标节点的子节点即可。</p>
<h2 id="目标有两个子树"><a href="#目标有两个子树" class="headerlink" title="目标有两个子树"></a>目标有两个子树</h2><p><img src="/2018/11/07/binarytree/delete-5.png" alt="二叉树-12"></p>
<p>当目标节点有两个子节点时，这种场景比较复杂。由于二叉搜索树的性质，删除的目标节点删除后，需要找到一个节点来替代目标节点，而替代的节点需要是目标节点的后继节点即，比目标节点大的最小值。所以需要获取目标节点右子树的最小值也就是目标节点右子树的最左节点。</p>
<h3 id="后继节点是目标节点的右子节点"><a href="#后继节点是目标节点的右子节点" class="headerlink" title="后继节点是目标节点的右子节点"></a>后继节点是目标节点的右子节点</h3><p><img src="/2018/11/07/binarytree/delete-7.png" alt="二叉树-14"></p>
<p><img src="/2018/11/07/binarytree/delete-6.png" alt="二叉树-13"></p>
<p>当后继节点为目标节点右子节点，即目标节点的右子节点没有左子树的场景。这个时候，只需要将目标节点的父节点对应子节点指向后继节点即可。</p>
<h3 id="后继节点是目标节点右子树中的左子节点"><a href="#后继节点是目标节点右子树中的左子节点" class="headerlink" title="后继节点是目标节点右子树中的左子节点"></a>后继节点是目标节点右子树中的左子节点</h3><p><img src="/2018/11/07/binarytree/delete-8.png" alt="二叉树-15"></p>
<p><img src="/2018/11/07/binarytree/delete-9.png" alt="二叉树-16"></p>
<p>当目标节点的右子节点右左子树时，则后继节点为右子树的最左节点，所以需要首先遍历目标节点的右子树的左子树。找到最左节点。</p>
<h1 id="宽度"><a href="#宽度" class="headerlink" title="宽度"></a>宽度</h1><p><img src="/2018/11/07/binarytree/width.png" alt="二叉树-17"></p>
<p>主要还是通过层序遍历的方式来统计每一层节点的子节点个数。没遍历一层，都会构建新的子节点队列。通过比较每一层的子节点个数之和来获取最大值，从而获取宽度。</p>
<h1 id="深度"><a href="#深度" class="headerlink" title="深度"></a>深度</h1><p><img src="/2018/11/07/binarytree/deep.png" alt="二叉树-18"></p>
<p>利用二叉搜索树的性质，直接进行深度优先遍历查找目标节点，没向下遍历一次则累加，这样获取深度。</p>
<h1 id="高度"><a href="#高度" class="headerlink" title="高度"></a>高度</h1><p><img src="/2018/11/07/binarytree/height.png" alt="二叉树-19"></p>
<h1 id="转换成数组"><a href="#转换成数组" class="headerlink" title="转换成数组"></a>转换成数组</h1><p><img src="/2018/11/07/binarytree/toArray.png" alt="二叉树-20"></p>
<p>主要还是采用层序遍历的思路，将下一层的节点都存储在队列中，如果当前节点没有子节点，也需要将结果队列中存储元素。这样最终的结果队列会是按照满二叉树的元素来存储整个树的层序遍历结果。</p>
<h2 id="数组的缺陷"><a href="#数组的缺陷" class="headerlink" title="数组的缺陷"></a>数组的缺陷</h2><p>从代码中就可以看到，数组存储二叉树的时候，空的节点也会占用存储空间，同时如果涉及到删除操作，还会牵扯到数组中数据的平移，效率很低。</p>
<ul>
<li>数组中index位置 其左子节点为<strong>2index+1</strong> 右子节点为<strong>2index+2</strong> 父节点 <strong>(index-1)/2</strong></li>
</ul>
<h1 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h1><p><a href="https://github.com/gudulongao/datastructalgorithm/blob/master/src/main/java/binarytree/demo/BinaryTree.java" target="_blank" rel="noopener">https://github.com/gudulongao/datastructalgorithm/blob/master/src/main/java/binarytree/demo/BinaryTree.java</a></p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><blockquote>
<p>参考网址：<a href="https://www.cnblogs.com/ysocean/p/8032642.html" target="_blank" rel="noopener">https://www.cnblogs.com/ysocean/p/8032642.html</a>  </p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/26/mysql-lock/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小磊砸">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小磊砸的布劳格">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/26/mysql-lock/" itemprop="url">Mysql锁</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-26T11:19:12+08:00">
                2018-09-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MySql数据库/" itemprop="url" rel="index">
                    <span itemprop="name">MySql数据库</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/09/26/mysql-lock/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/09/26/mysql-lock/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="锁"><a href="#锁" class="headerlink" title="锁"></a>锁</h1><h1 id="MVCC并发控制"><a href="#MVCC并发控制" class="headerlink" title="MVCC并发控制"></a>MVCC并发控制</h1><p>多版本并发控制（Multi-Version-Concurrency-Control）。<br>InnoDB存储引擎，当事务的隔离级别为可重复读(REPEATABLE-READ)时。对于每一行数据都增加了两个隐藏列，一列是存储创建该行数据的系统版本号，另一列是删除该行的系统版本号。</p>
<ul>
<li>新增时，行数据的创建版本号为当前事务对应的系统版本号，删除版本号为空。</li>
<li>查询时，只会查询到创建版本号小于等于当前事务的系统版本号，删除版本号未定义或者大于等于当前事务的版本号，即在当前事务开始时存在并且未删除的数据。</li>
<li>删除时，行数据的删除版本号为当前事务对应的系统版本号。</li>
<li>修改时，会新增一条数据，这条新数据的新增版本号为当前事务对应的系统版本号，删除版本号未定义。老数据的删除版本号为当前事务对应的系统版本号。</li>
</ul>
<p>这样保证了客重复读即在同一个事物中对于表的数据不会受到别的事务修改提交的影响。只会读取到当前事务创建时的数据状态。</p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><blockquote>
<p>Mysql锁：<a href="https://blog.csdn.net/soonfly/article/details/70238902" target="_blank" rel="noopener">https://blog.csdn.net/soonfly/article/details/70238902</a></p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/25/mac-help/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小磊砸">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小磊砸的布劳格">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/25/mac-help/" itemprop="url">Mac报错笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-25T23:45:32+08:00">
                2018-09-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Mac系统/" itemprop="url" rel="index">
                    <span itemprop="name">Mac系统</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/09/25/mac-help/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/09/25/mac-help/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="升级后问题"><a href="#升级后问题" class="headerlink" title="升级后问题"></a>升级后问题</h1><h2 id="missing-xcrun"><a href="#missing-xcrun" class="headerlink" title="missing xcrun"></a>missing xcrun</h2><h3 id="问题现象"><a href="#问题现象" class="headerlink" title="问题现象"></a>问题现象</h3><p><img src="/2018/09/25/mac-help/error-1.png" alt="包装生成线程安全的hashmap"></p>
<h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xcode-select --install</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/25/transection-isolation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小磊砸">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小磊砸的布劳格">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/25/transection-isolation/" itemprop="url">Mysql事务</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-25T14:24:46+08:00">
                2018-09-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MySql数据库/" itemprop="url" rel="index">
                    <span itemprop="name">MySql数据库</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/09/25/transection-isolation/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/09/25/transection-isolation/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>事务是数据库并发控制的基本单元。<strong>在Mysql数据库中，只有InnoDB存储引擎支持事务</strong>。</p>
<h1 id="事务的属性"><a href="#事务的属性" class="headerlink" title="事务的属性"></a>事务的属性</h1><ul>
<li><strong>原子性(Atomicity)</strong>：事务中的操作要么全部执行成功要么全部执行失败。</li>
<li><strong>一致性(consistency)</strong>：事务执行前后，数据库中的数据都满足数据的完整性，符合业务需求(比如转账操作，一个账户的钱减少另一个账户的钱相应的减少。这种业务操作需要在一个事务中，这样在转账操作才会符合我们的业务需求)。  </li>
<li><strong>隔离型(isolation)</strong>：事务之间是隔离的，互相不影响的。</li>
<li><strong>持久性(durability)</strong>：事务提交后，对于数据库的修改是永久性的。</li>
</ul>
<h1 id="事务并发问题"><a href="#事务并发问题" class="headerlink" title="事务并发问题"></a>事务并发问题</h1><ul>
<li>更新丢失：两个事务A，B同时修改数据2，事务A将2修改为3，事务B将2修改为1，事务A提交了，事务B回滚了，则会将数据回滚到初始值2，即丢失了事务A的修改。</li>
<li>脏读：事务A读取了事务B未提交修改的数据，后续事务B回滚，则A读取的数据为脏数据。</li>
<li>不可重复读：事务多次读取同一数据但是结果不一致。事务A多次读取一数据，但是在这个过程中，事务B不断的修改这一数据，所以导致事务A每次读取的数据都不一致。<strong>修改操作</strong>会导致不可重复读。</li>
<li>幻读：事务A在统计某张表的总数时，事务B不断的插入数据，导致事务A读取的总数不对。<strong>新增或者删除操作</strong>会导致幻读。</li>
</ul>
<h1 id="隔离级别"><a href="#隔离级别" class="headerlink" title="隔离级别"></a>隔离级别</h1><table>
<thead>
<tr>
<th>类型</th>
<th style="text-align:center">更新丢失</th>
<th style="text-align:center">脏读</th>
<th style="text-align:center">不可重复读</th>
<th style="text-align:center">幻读</th>
</tr>
</thead>
<tbody>
<tr>
<td>读未提交(read-uncommited)</td>
<td style="text-align:center">❌</td>
<td style="text-align:center">✅</td>
<td style="text-align:center">✅</td>
<td style="text-align:center">✅</td>
</tr>
<tr>
<td>读提交(read-commited)</td>
<td style="text-align:center">❌</td>
<td style="text-align:center">❌</td>
<td style="text-align:center">✅</td>
<td style="text-align:center">✅</td>
</tr>
<tr>
<td>可重复读(repeatble-read)</td>
<td style="text-align:center">❌</td>
<td style="text-align:center">❌</td>
<td style="text-align:center">❌</td>
<td style="text-align:center">✅</td>
</tr>
<tr>
<td>串行化(serializable)</td>
<td style="text-align:center">❌</td>
<td style="text-align:center">❌</td>
<td style="text-align:center">❌</td>
<td style="text-align:center">❌</td>
</tr>
</tbody>
</table>
<p>其中读未提交和读已提交都好理解。对于可重复读，根据实践操作可以验证，事务A读取的数据，不会受到事务B的修改操作而影响。哪怕事务B已将数据清空或者插入新的数据，在事务A中都不会读取到这些修改。故对于可重复读的事务隔离，是会有幻读的问题。</p>
<h1 id="样例"><a href="#样例" class="headerlink" title="样例"></a>样例</h1><h2 id="读未提交-read-uncommitted"><a href="#读未提交-read-uncommitted" class="headerlink" title="读未提交(read uncommitted)"></a>读未提交(read uncommitted)</h2><table>
<thead>
<tr>
<th>步骤</th>
<th>连接A</th>
<th>连接B</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td><img src="/2018/09/25/transection-isolation/read-uncommitted-a-1.png" alt="包装生成线程安全的hashmap"></td>
<td></td>
</tr>
<tr>
<td></td>
<td>设置隔离级别。更新数据。未提交</td>
<td></td>
</tr>
<tr>
<td>2</td>
<td></td>
<td><img src="/2018/09/25/transection-isolation/read-uncommitted-b-2.png" alt="包装生成线程安全的hashmap"></td>
</tr>
<tr>
<td></td>
<td></td>
<td>设置隔离级别，查询数据，发现可以查询到连接A未提交的数据</td>
</tr>
</tbody>
</table>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><blockquote>
<p>事务隔离：<a href="https://blog.csdn.net/jiyiqinlovexx/article/details/50967965" target="_blank" rel="noopener">https://blog.csdn.net/jiyiqinlovexx/article/details/50967965</a><br>事务：<a href="https://www.cnblogs.com/huanongying/p/7021555.html" target="_blank" rel="noopener">https://www.cnblogs.com/huanongying/p/7021555.html</a><br>事务命令操作：<a href="https://blog.csdn.net/zhu4674548/article/details/75195253" target="_blank" rel="noopener">https://blog.csdn.net/zhu4674548/article/details/75195253</a>  </p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/20/mysql-command/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小磊砸">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小磊砸的布劳格">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/20/mysql-command/" itemprop="url">MySql常用操作命令</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-20T15:19:42+08:00">
                2018-09-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MySql数据库/" itemprop="url" rel="index">
                    <span itemprop="name">MySql数据库</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/09/20/mysql-command/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/09/20/mysql-command/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="查看mysql服务"><a href="#查看mysql服务" class="headerlink" title="查看mysql服务"></a>查看mysql服务</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo /usr/locl/mysql/support-files/mysql.server start 启动服务</span><br><span class="line">sudo /usr/locl/mysql/support-files/mysql.server stop 停止服务</span><br><span class="line">mysql -V 输出mysql版本</span><br></pre></td></tr></table></figure>
<h1 id="登陆-退出"><a href="#登陆-退出" class="headerlink" title="登陆/退出"></a>登陆/退出</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p 以root用户进行密码登陆</span><br><span class="line">mysql [-h ip]  [-P port] -u user -p 指定ip和端口进行用户登陆，ip和端口条件非必须</span><br><span class="line">exit/quit 退出登陆</span><br></pre></td></tr></table></figure>
<h1 id="创建用户"><a href="#创建用户" class="headerlink" title="创建用户"></a>创建用户</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create user &apos;username&apos;@&apos;host&apos; identified by &apos;password&apos;; 创建用户</span><br><span class="line">drop user &apos;username&apos;@&apos;host&apos;; 删除用户</span><br><span class="line">set password for &apos;username&apos;@&apos;host&apos;= password(&apos;password&apos;); 设置密码</span><br><span class="line">set password = password(&apos;password&apos;);给当前用户设置密码</span><br></pre></td></tr></table></figure>
<p>host需要特别说明：该参数指定了该用户可以登陆的域名，<strong>如果想从任意位置进行登陆使用通配符%。</strong></p>
<p>mysql用户表如图所示：</p>
<p><img src="/2018/09/20/mysql-command/mysql.user.png" alt="包装生成线程安全的hashmap"></p>
<h1 id="授权"><a href="#授权" class="headerlink" title="授权"></a>授权</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">grant [select|update|insert|delete|all] on databasename.tablename to &apos;username&apos;@&apos;host&apos;;授权</span><br><span class="line">grant [select|update|insert|delete|all] on databasename.tablename to &apos;username&apos;@&apos;host&apos; with grant option; 给该用户授予的权力，该用户也可以授权给别的用户</span><br><span class="line">show grants for &apos;username&apos;@&apos;host&apos;;查看给用户的授权</span><br><span class="line">revoke [select|update|insert|delete|all] on databasename.tablename from &apos;username&apos;@&apos;host&apos;;撤销授权</span><br></pre></td></tr></table></figure>
<h1 id="查看数据库"><a href="#查看数据库" class="headerlink" title="查看数据库"></a>查看数据库</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">show databases 查看已有的数据库</span><br><span class="line">use databases dbname 选择采用的数据库</span><br></pre></td></tr></table></figure>
<h1 id="查看表结构"><a href="#查看表结构" class="headerlink" title="查看表结构"></a>查看表结构</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">desc tablename 查看表结构  </span><br><span class="line">show create table tablename 查看建表语句</span><br></pre></td></tr></table></figure>
<p><img src="/2018/09/20/mysql-command/showtable.png" alt="包装生成线程安全的hashmap"></p>
<h1 id="修改表结构"><a href="#修改表结构" class="headerlink" title="修改表结构"></a>修改表结构</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">alter table tablename add columnname 数据类型 [primary key/default/not null]；新增列</span><br><span class="line">alter table tablename drop columnname；删除列</span><br><span class="line">alter table tablename change oldcolumnname newcolumnname 数据类型 [primary key/default/not null];修改列名</span><br><span class="line">alter table tablename modify columnname 数据类型 [primary key/default/not null];修改列</span><br><span class="line">alter table tablename rename to newtablename;修改表名</span><br></pre></td></tr></table></figure>
<p><strong>经过测试发现，modify 命令如果后续没有约束，则会清空列已有的约束（不包含主键约束）。如果modify中包含列的约束，则会对列增加约束（包含主键约束）。</strong></p>
<p><img src="/2018/09/20/mysql-command/modifycolumn-1.png" alt="包装生成线程安全的hashmap"><br><img src="/2018/09/20/mysql-command/modifycolumn-2.png" alt="包装生成线程安全的hashmap"></p>
<h1 id="修改约束"><a href="#修改约束" class="headerlink" title="修改约束"></a>修改约束</h1><p>Mysql支持的约束有：  </p>
<ul>
<li>主键约束：primary key。  </li>
<li>外键约束：foreign key。  </li>
<li>唯一：unique.  </li>
<li>非空：not null。</li>
</ul>
<p><strong>可以看到,mysql并不支持check表达式的约束条件，但是在mysql中使用check指令不会报错，但是并没有作用。</strong></p>
<h2 id="主键约束"><a href="#主键约束" class="headerlink" title="主键约束"></a>主键约束</h2><p><img src="/2018/09/20/mysql-command/primary-key.png" alt="包装生成线程安全的hashmap"></p>
<h2 id="唯一约束"><a href="#唯一约束" class="headerlink" title="唯一约束"></a>唯一约束</h2><p><img src="/2018/09/20/mysql-command/unique.png" alt="包装生成线程安全的hashmap"></p>
<p>如图所示，先对列name增加了unique约束，如果想要去除该约束，需要查看约束的名字，一般在定义约束的时候，我们最好还是顺便指定约束的名称，但是在创建的时候没有制定，我们也可以通过查看DDL语句来查看约束的名称，这样我慢看到name字段的unique约束的名称为name，在删除约束的时候还需要注意的是，drop 后面一定要加index，否则会被认为是要删除列。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alter table tablename add [check_name] (primary key/foreign key/unique/not null) 添加约束，注意最好制定约束名</span><br><span class="line">alter table tablename drop index check_name 通过约束名来去除字段的约束，如果不记得约束名，可以通过show create table tablename来查看DDL语句。</span><br></pre></td></tr></table></figure>
<h1 id="修改索引"><a href="#修改索引" class="headerlink" title="修改索引"></a>修改索引</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alter table tablename add index indexname (columname,[columnname2...])；新增索引</span><br><span class="line">alter table tablename drop index indexname；删除索引</span><br></pre></td></tr></table></figure>
<h1 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h1><h2 id="查看隔离级别"><a href="#查看隔离级别" class="headerlink" title="查看隔离级别"></a>查看隔离级别</h2><p><img src="/2018/09/20/mysql-command/showtranscationisolation.png" alt="包装生成线程安全的hashmap"></p>
<p>如图所示，通过查看环境变量’isolation’来查看mysql默认的事务隔离级别，可以看到mysql事务的默认隔离级别为<strong>可重复读(REPEATABLE-READ)</strong>。</p>
<h2 id="修改隔离级别"><a href="#修改隔离级别" class="headerlink" title="修改隔离级别"></a>修改隔离级别</h2><p><img src="/2018/09/20/mysql-command/updatetranscation.png" alt="包装生成线程安全的hashmap"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set global|session transaction isolation level (read committed|read uncommited|repeatable read|serializable) 设置全局|会话的事务隔离级别。</span><br></pre></td></tr></table></figure>
<h2 id="使用事务"><a href="#使用事务" class="headerlink" title="使用事务"></a>使用事务</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">start transaction;开启事务</span><br><span class="line">commit;提交事务</span><br><span class="line">rollback;回滚事务</span><br></pre></td></tr></table></figure>
<h1 id="SQL效率"><a href="#SQL效率" class="headerlink" title="SQL效率"></a>SQL效率</h1><h2 id="查看执行时间"><a href="#查看执行时间" class="headerlink" title="查看执行时间"></a>查看执行时间</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">show variables； 查看mysql配置参数，主要查找profiling参数是否开启</span><br><span class="line">set profiling = 1； 开启profile配置</span><br><span class="line">show profiles；查看sql指令的耗时</span><br></pre></td></tr></table></figure>
<p><img src="/2018/09/20/mysql-command/showprofiles.png" alt="包装生成线程安全的hashmap"></p>
<h2 id="查看SQL执行效率"><a href="#查看SQL执行效率" class="headerlink" title="查看SQL执行效率"></a>查看SQL执行效率</h2><p>在每次执行sql语句的前面添加explain关键词，就能够输出mysql执行该sql语句的执行效率。</p>
<p><img src="/2018/09/20/mysql-command/explain.png" alt="包装生成线程安全的hashmap"></p>
<h3 id="id"><a href="#id" class="headerlink" title="id"></a>id</h3><p>sql执行的标志。</p>
<ul>
<li>如果id相同，则表明这些sql为同一组操作，会按照顺序自上而下的执行。</li>
<li>如果是子查询，id会增加。即id越大执行的优先级越高。</li>
</ul>
<h3 id="select-typea"><a href="#select-typea" class="headerlink" title="select_typea"></a>select_typea</h3><p>查询的类型</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>SIMPLE</td>
<td>简单查询，没有使用UNION或者子查询</td>
</tr>
<tr>
<td>PRIMARY</td>
<td>使用了嵌套查询，则外层查询语句被标记为PRIMARY</td>
</tr>
<tr>
<td>UNION</td>
<td>使用UNION关键词，则UNION后面的SQL语句被标记为UNION</td>
</tr>
<tr>
<td>DEPENDENT UNION</td>
<td>使用UNION关键词，则UNION后面的SQL语句被标记为UNION，取决于外层查询</td>
</tr>
<tr>
<td>UNION RESULT</td>
<td>UNION查询的结果</td>
</tr>
<tr>
<td>SUBQUERY</td>
<td>子查询的第一个select</td>
</tr>
<tr>
<td>DEPENDENT SUBQUERY</td>
<td>子查询的第一个select,取决于外层查询</td>
</tr>
<tr>
<td>DERIVED</td>
<td>派生的表（匿名的表）查询的子查询</td>
</tr>
<tr>
<td>UNCACHEABLE SUBQUERY</td>
<td>一个子查询的结果没有被缓存，必须重新评估外链接的第一行</td>
</tr>
</tbody>
</table>
<h3 id="table"><a href="#table" class="headerlink" title="table"></a>table</h3><p>当前语句涉及到的表名，有时不是真实的表名。</p>
<p><img src="/2018/09/20/mysql-command/explain-table.png" alt="包装生成线程安全的hashmap"></p>
<h3 id="partitions"><a href="#partitions" class="headerlink" title="partitions"></a>partitions</h3><p>代表表所使用的分区。目前我不太懂这个有什么用，我的机器输出的结果是null。</p>
<h3 id="type"><a href="#type" class="headerlink" title="type"></a>type</h3><p>访问类型，常用的有<strong>ALL, index,  range, ref, eq_ref, const, system, NULL（从左到右，性能从差到好）</strong>。</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>ALL</td>
<td>全表检索，即mysql遍历所有的行数据才能检索到匹配的数据</td>
</tr>
<tr>
<td>index</td>
<td>全索引检索，即mysql遍历了整个索引树才检索到匹配的数据</td>
</tr>
<tr>
<td>range</td>
<td>在一定范围的行数据中，通过索引来找到匹配的数据</td>
</tr>
<tr>
<td>ref</td>
<td>使用了表连接或者匹配条件中，有使用常量</td>
</tr>
<tr>
<td>eq_ref</td>
<td>在使用表连接的时候，连接的列具有唯一性，即主键或外键</td>
</tr>
<tr>
<td>const</td>
<td>mysql对查询的优化，如果where语句中有主键，则会将整个查询转换成常量</td>
</tr>
<tr>
<td>system</td>
<td>mysql对查询的优化，与const一样，特殊在如果表只有一行数据的时候，采用system</td>
</tr>
<tr>
<td>NULL</td>
<td>mysql在执行sql分解语句时，无需查找表和索引</td>
</tr>
</tbody>
</table>
<h3 id="possible-keys"><a href="#possible-keys" class="headerlink" title="possible_keys"></a>possible_keys</h3><p>查询数据时，能够匹配到数据的索引。</p>
<p><img src="/2018/09/20/mysql-command/explain-type.png" alt="包装生成线程安全的hashmap"></p>
<p>如图所示，接连执行的两条sql语句，可以看到，第二条sql语句中where包含主键的条件，查询的数据可以通过主键索引，也可以通过地址索引，两个索引来检索到第三行数据，故possible_keys中指出了能够检索到这条数据的索引有两个。同时也论证了type列的const的含义，即一旦条件中有主键，mysql就会将该条查询常量化。</p>
<h3 id="key"><a href="#key" class="headerlink" title="key"></a>key</h3><p>查询时，实际使用到的索引。</p>
<h3 id="key-len"><a href="#key-len" class="headerlink" title="key_len"></a>key_len</h3><p>索引字段的最大长度。便于优化索引的长度（索引越短越好）。</p>
<h3 id="rows"><a href="#rows" class="headerlink" title="rows"></a>rows</h3><p>sql语句查询时遍历的行数。</p>
<h3 id="Extra"><a href="#Extra" class="headerlink" title="Extra"></a>Extra</h3><p>额外信息。</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Using where</td>
<td>根据where条件来通过索引来检索数据。</td>
</tr>
<tr>
<td>Using temporary</td>
<td>mysql需要使用到临时表空间来进行检索，在分组和排序的时候常见</td>
</tr>
<tr>
<td>Using filesort</td>
<td>mysql无法通过索引来进行的排序，<strong>这种情况需要考虑添加索引了</strong></td>
</tr>
<tr>
<td>Using join buffer</td>
<td>表连接的时候，连接条件没有使用到索引字段，所以需要采用额外的缓冲区来保持结果，<strong>需要在表连接的时候使用索引列，或者添加索引</strong></td>
</tr>
<tr>
<td>Impossible where</td>
<td>where语句可能会有没有符合条件的数据</td>
</tr>
<tr>
<td>Select tables optimized away</td>
<td>仅仅使用索引，优化器可能仅从聚合函数结果中返回一行（<strong>不懂</strong>）</td>
</tr>
</tbody>
</table>
<h3 id="缺陷"><a href="#缺陷" class="headerlink" title="缺陷"></a>缺陷</h3><ul>
<li>explain 只能对select 语句进行效率分析。  </li>
<li>explain 不会考虑到缓存。  </li>
<li>explain 的分析结果不会考虑触发器，存储过程以及自定义函数的结果。   </li>
</ul>
<h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><h2 id="清屏"><a href="#清屏" class="headerlink" title="清屏"></a>清屏</h2><p>Ctrl+L 快捷键清屏</p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><blockquote>
<p>查看表结构：<a href="https://www.cnblogs.com/zhangyuhang3/p/6873895.html" target="_blank" rel="noopener">https://www.cnblogs.com/zhangyuhang3/p/6873895.html</a><br>修改表结构：<a href="https://blog.csdn.net/airjordon/article/details/72676607" target="_blank" rel="noopener">https://blog.csdn.net/airjordon/article/details/72676607</a><br>explain详解：<a href="https://www.cnblogs.com/xuanzhi201111/p/4175635.html" target="_blank" rel="noopener">https://www.cnblogs.com/xuanzhi201111/p/4175635.html</a></p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/19/mysql-engine/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小磊砸">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小磊砸的布劳格">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/19/mysql-engine/" itemprop="url">MySql存储引擎</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-19T10:37:03+08:00">
                2018-09-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MySql数据库/" itemprop="url" rel="index">
                    <span itemprop="name">MySql数据库</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/09/19/mysql-engine/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/09/19/mysql-engine/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="相关指令"><a href="#相关指令" class="headerlink" title="相关指令"></a>相关指令</h1><h2 id="查看存储引擎"><a href="#查看存储引擎" class="headerlink" title="查看存储引擎"></a>查看存储引擎</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show engines 查看当前数据库支持的存储引擎</span><br></pre></td></tr></table></figure>
<p><img src="/2018/09/19/mysql-engine/showengines.png" alt="包装生成线程安全的hashmap"></p>
<p>从结果中可以看到，mysql数据库默认采用的存储引擎是<strong>InnoDB</strong>。</p>
<h2 id="设置存储引擎"><a href="#设置存储引擎" class="headerlink" title="设置存储引擎"></a>设置存储引擎</h2><ul>
<li>可以在创建表的时候通过ENGINE来指定存储引擎。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE country(</span><br><span class="line">    country_id SMALLINT UNSIGNED NOT NULL AUTO_INCREMENT,</span><br><span class="line">    country VARCHAR(50) NOT NULL,</span><br><span class="line">    last_update TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,</span><br><span class="line">    PRIMARY KEY (country_id)</span><br><span class="line">) ENGINE = InnoDB DEFAULT CHARSET=gbk;</span><br></pre></td></tr></table></figure>
<ul>
<li>可以通过修改表结构来设置存储引擎</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALERT TABLE 表名 ENGINE = INNODB;</span><br></pre></td></tr></table></figure>
<h1 id="InnoDB"><a href="#InnoDB" class="headerlink" title="InnoDB"></a>InnoDB</h1><ul>
<li><strong>MySql5.5.8版本以后的默认的存储引擎</strong>。</li>
<li><strong>支持事务，支持行锁。支持外键</strong>。</li>
<li>支持自增（AUTO_INCREMENT）。<strong>支持自增的列必须是数值型的主键。</strong></li>
<li>表结构存储在.frm文件中，数据和索引存储在innodb_data_home和innodb_data_path表空间中。</li>
<li>数据存储采用聚集的方式按照主键的顺序存储。如果在创建表的时候没有指定主键，存储引擎会为每一行数据默认的生成一个6字节长度rowID，并以此作为主键。</li>
<li>InnoDB采用多版本并发控制(MVCC)来控制并发。支持数据库的4种隔离机制。</li>
</ul>
<p><img src="/2018/09/19/mysql-engine/increment.png" alt="包装生成线程安全的hashmap"></p>
<p><img src="/2018/09/19/mysql-engine/desctable.png" alt="包装生成线程安全的hashmap"></p>
<h1 id="MyISAM"><a href="#MyISAM" class="headerlink" title="MyISAM"></a>MyISAM</h1><ul>
<li><strong>Mysql5.5.8版本之前的默认存储引擎</strong>。</li>
<li>MyISAM不支持事务，外键。</li>
<li>MyISAM支持全文检索。</li>
<li>MyISAM存储引擎由frm(存储表结构),MYD(存储数据),MYI（存储索引）三个文件组成。</li>
<li>5.0版本以前默认支持4GB大小存储。通过指定MAX_ROWS和AVG_ROW_LENGTH参数可以支持大于4GB容量。</li>
<li>缓冲池只存储索引文件，数据的缓存交由操作系统负责。</li>
</ul>
<h1 id="MEMORY"><a href="#MEMORY" class="headerlink" title="MEMORY"></a>MEMORY</h1><p>将数据加载在内存中，表结构存储在位于磁盘并与表名同名的frm文件中。<br>存储引擎默认使用哈希索引，在4.1版本前只支持哈希索引，故需要整个键来索引，效率不及MyISAM。4.1版本后支持哈希索引和B树索引。<br>MEMORY表的大小由max_rows和max_heap_table_size决定。max_rows可以在建表时制定。max_heap_table_size默认16M。可以拓展。<strong>如果表的数据量超过设置，mysql会将超出的部分自动按照MyISAM存储引擎来进行存储。</strong>  </p>
<ul>
<li>临时数据。当数据是临时使用同时在其生命周期内存在即可，可以考虑使用MEMORY存储引擎来进行数据存储。</li>
<li>相对无关的数据。数据库宕机数据丢失不会影响业务系统的正常运作。</li>
</ul>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><ul>
<li>mysql貌似各种存储引擎的表结构都是用frm文件进行存储的。</li>
</ul>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><blockquote>
<p>存储引擎：<a href="https://www.cnblogs.com/shijiaqi1066/p/3857808.html" target="_blank" rel="noopener">https://www.cnblogs.com/shijiaqi1066/p/3857808.html</a></p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/19/mysql-index/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小磊砸">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小磊砸的布劳格">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/19/mysql-index/" itemprop="url">mysql索引</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-19T00:13:17+08:00">
                2018-09-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MySql数据库/" itemprop="url" rel="index">
                    <span itemprop="name">MySql数据库</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/09/19/mysql-index/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/09/19/mysql-index/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><blockquote>
<p>索引实现原理 <a href="https://blog.csdn.net/tongdanping/article/details/79878302" target="_blank" rel="noopener">https://blog.csdn.net/tongdanping/article/details/79878302</a><br>mysql索引指令 <a href="https://blog.csdn.net/lzupb/article/details/78413712" target="_blank" rel="noopener">https://blog.csdn.net/lzupb/article/details/78413712</a><br>csdn索引相关 <a href="https://www.csdn.net/gather_2e/MtTaIg5sMTg4OC1ibG9n.html" target="_blank" rel="noopener">https://www.csdn.net/gather_2e/MtTaIg5sMTg4OC1ibG9n.html</a><br>mysql存储引擎 <a href="https://www.cnblogs.com/shijiaqi1066/p/3857808.html" target="_blank" rel="noopener">https://www.cnblogs.com/shijiaqi1066/p/3857808.html</a>  </p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/18/jvm-3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小磊砸">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小磊砸的布劳格">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/18/jvm-3/" itemprop="url">JVM配置参数</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-18T23:43:02+08:00">
                2018-09-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/jvm/" itemprop="url" rel="index">
                    <span itemprop="name">jvm</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/09/18/jvm-3/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/09/18/jvm-3/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="虚拟机栈-本地方法栈"><a href="#虚拟机栈-本地方法栈" class="headerlink" title="虚拟机栈/本地方法栈"></a>虚拟机栈/本地方法栈</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-Xss 设置虚拟机栈大小</span><br><span class="line">-Xoss 设置本地方法栈大小（Sun HotSpot无效，不区分虚拟机栈和本地方法栈）</span><br></pre></td></tr></table></figure>
<h1 id="堆空间配置"><a href="#堆空间配置" class="headerlink" title="堆空间配置"></a>堆空间配置</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-Xms 最小</span><br><span class="line">-Xmx 最大</span><br><span class="line">-XX:+HeapDumpOnOutOfMemoryError 当堆内存溢出时将当前的堆空间生成快照</span><br></pre></td></tr></table></figure>
<h1 id="方法区"><a href="#方法区" class="headerlink" title="方法区"></a>方法区</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-XX:PermSize 方法区大小</span><br><span class="line">-XX:MaxPermSize 最大方法区</span><br></pre></td></tr></table></figure>
<p>运行时常量池本位于方法区，故通过配置方法区的大小来限制运行时常量池的大小。</p>
<h1 id="直接内存"><a href="#直接内存" class="headerlink" title="直接内存"></a>直接内存</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-XX:MaxDirectMemorySize 最大直接内存（如果不指定该配置，则默认与-Xms一样）</span><br></pre></td></tr></table></figure>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><blockquote>
<p>《深入理解java虚拟机》 周志明 编著<br>  堆分代的内存空间配置<a href="https://blog.csdn.net/blueheart20/article/details/52092535" target="_blank" rel="noopener">https://blog.csdn.net/blueheart20/article/details/52092535</a></p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/17/TCP-UDP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小磊砸">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小磊砸的布劳格">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/17/TCP-UDP/" itemprop="url">TCP/UDP</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-17T22:38:35+08:00">
                2018-09-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/网络/" itemprop="url" rel="index">
                    <span itemprop="name">网络</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/09/17/TCP-UDP/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/09/17/TCP-UDP/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="传输层"><a href="#传输层" class="headerlink" title="传输层"></a>传输层</h1><p>通过网络模型的定义可以知道，网络层基于IP网络协议提供了不同主机的互通互联，但是实际进行通信的是主机中的进程，即网络层只能将通信报文交付到对应的主机，而具体处理报文的还是主机中的进程，故需要在传输层中将报文交付到实际的应用进程，达到端到端的互通。</p>
<h2 id="UDP"><a href="#UDP" class="headerlink" title="UDP"></a>UDP</h2><ul>
<li>传输之前不需要建立连接。主机收到报文之后也不用发送确认报文。即<strong>UDP提供不可靠的数据传输</strong>。但正是因为这样，节省了建立连接和断开连接的开销，同时减少了数据流量。所以<strong>UDP的传输速度较快，适合实时性较高的数据传输</strong>。    </li>
<li>对应的应用层的协议主要有 DNS,TFTP,DHCP,SNMP,NFS 等。</li>
</ul>
<h2 id="TCP"><a href="#TCP" class="headerlink" title="TCP"></a>TCP</h2><ul>
<li>数据传输之前必须建立连接，数据传输完毕后要释放连接。即<strong>TCP提供可靠的数据传输</strong>。但正是因为这样，需要额外的系统开销。</li>
<li>对应的应用层的协议主要有 SMTP,TELNET,HTTP,FTP 等。</li>
</ul>
<blockquote>
<p>同步位SYN：TCP协议请求建立连接的信号标志。当SYN=1,ACK=0时，请求建立连接，当SYN=1,ACK=1时，同意建立连接。<br>确认位ACK：TCP协议建立连接的信号标志，TCP规定，当连接建立后，所有报文传输ACK=1。<br>终止FIN：用来释放连接，当FIN=1,表明报文已传输完毕，请求释放连接。<br>紧急位URG：URG=1，表明该报文中有紧急数据。<br>序列号seq：TCP传输的报文序号，<strong>4个字节</strong>。比如序号为300，数据有100个字节，则下一个报文段为400。<br>确认号ack：期望收到的下一个报文序号，<strong>4个字节</strong>。比如服务端收到报文的序列号300，数据有100个字节，那么服务端期望收到的下一个报文序号为400，即回复的确认报文中确认号为400。  </p>
</blockquote>
<h1 id="TCP创建连接（三次握手）"><a href="#TCP创建连接（三次握手）" class="headerlink" title="TCP创建连接（三次握手）"></a>TCP创建连接（三次握手）</h1><p><img src="/2018/09/17/TCP-UDP/createconn.png" alt="包装生成线程安全的hashmap"></p>
<ul>
<li>开始，客户端和服务端都是关闭的，客户端主动打开连接，服务端被动打开。  </li>
<li>服务器被动打开连接之后，创建TCB(传输控制块)，等待客户端的连接请求，进入LISTEN状态。  </li>
<li>客户端创建TCB之后发送创建连接请求：同步位SYN=1，初始序列号seq=x。客户端进入SYN_SENT状态。<strong>TCP规定，SYN报文不能携带数据，但需要消耗一个序列号</strong>。  </li>
<li>服务端收到创建连接请求之后，发送确认报文：同步位SYN=1，确认位ACK=1，确认号ack=x+1，服务端的序列号seq=y。服务端进入SYN_RECD状态。<strong>确认报文也无法携带数据，有需要消耗一个序列号</strong>。  </li>
<li>客户端收到服务端的确认报文之后，发送确认报文：ACK=1，确认号ack=y+1，客户端序列号seq=x+1。客户端进入ESTABLISHED状态。<strong>TCP规定ACK报文可以携带数据，但如果没有携带数据可以不消耗序列号</strong>。</li>
<li>服务端收到客户端的确认报文后，进入ESTABLISHED状态。至此连接创建完毕。可以传输数据。  </li>
</ul>
<h2 id="为什么TCP客户端最后还要发送一次确认呢？"><a href="#为什么TCP客户端最后还要发送一次确认呢？" class="headerlink" title="为什么TCP客户端最后还要发送一次确认呢？"></a>为什么TCP客户端最后还要发送一次确认呢？</h2><p>如果使用两次握手，客户端第一次发送的建立连接请求由于网络阻塞的问题滞留太长，客户端又重新发送了第二次建立连接的请求。这个时候服务器收到请求并建立连接，当数据传输完毕释放连接之后，服务端收到了因为网络阻塞的第一次建立连接请求，而实际该报文已过期，但服务端还是会回复确认建立连接，这样会造成资源的浪费。</p>
<h1 id="TCP释放连接（四次挥手）"><a href="#TCP释放连接（四次挥手）" class="headerlink" title="TCP释放连接（四次挥手）"></a>TCP释放连接（四次挥手）</h1><p><img src="/2018/09/17/TCP-UDP/releaseconn.png" alt="包装生成线程安全的hashmap"></p>
<ul>
<li>客户端发送完数据后，发送请求释放连接报文：FIN=1，seq=u(前面已发送的数据最后一个字节+1)。<strong>TCP规定FIN报文不能携带数据，但是要消耗一个序列号</strong>。客户端进入FIN-WAIT-1状态。</li>
<li>服务端收到释放连接请求报文后，通知应用层进程，告知客户端数据已发送完毕，准备关闭连接。并回复确认报文：ACK=1，seq=v,ack=u+1。这个时候如果服务端还有数据要传输还可以传输。服务端进入CLOSE-WAIT状态。</li>
<li>客户端收到确认报文后，进入FIN-WAIT-2状态。</li>
<li>服务端如果所有数据也都传输完毕，可以发送FIN报文:FIN=1，ACK=1，seq=w，ack=u+1。服务端进入LAST-ACK状态。</li>
<li>客户端收到服务端的FIN报文后，知道服务端也没有要传输的数据，发送确认ACK报文:ACK=1,seq=u+1,ack=w+1。但客户端需要等待2*MSL(maximum segment leftime 最长报文时间)才能关闭连接。</li>
<li>服务端收到客户端的确认报文后，立即关闭连接。</li>
</ul>
<h2 id="客户端为什么要等待2-MSL时长"><a href="#客户端为什么要等待2-MSL时长" class="headerlink" title="客户端为什么要等待2*MSL时长"></a>客户端为什么要等待2*MSL时长</h2><ul>
<li>为了使得客户端所有的报文都能到达服务端。比如客户端最后一次的确认报文因为网络阻塞没有按时到达服务端，服务端会因为没有收到客户端的确认报文而重传，这个时候客户端会再次收到服务端的FIN报文，这个时候客户端也会重新发起一次确认报文。</li>
<li>为了使得新的连接中不会获取到失效的过期报文，在两个MSL时长可以使得网络中所有客户端发送的因为阻塞的而未到达服务端的报文都消失。</li>
</ul>
<h2 id="为什么释放要4次而建立要3次"><a href="#为什么释放要4次而建立要3次" class="headerlink" title="为什么释放要4次而建立要3次"></a>为什么释放要4次而建立要3次</h2><p>4次的原因是因为到服务端收到客户端的FIN报文后，仅仅表示客户端的数据已传输完毕，但是服务端的数据还未必传输完毕，故在收到FIN报文后，先要通知应用层的进程，准备关闭连接，这个时候回复客户端已收到关闭连接的请求报文。但候服务端还是会传输服务端的数据，等到服务端的数据传输完毕之后，服务端才能明确的告知客户端可以关闭连接。</p>
<h2 id="如果连接建立，但客户端故障怎么办？"><a href="#如果连接建立，但客户端故障怎么办？" class="headerlink" title="如果连接建立，但客户端故障怎么办？"></a>如果连接建立，但客户端故障怎么办？</h2><p>TCP有一个探测机制。每一个连接都会有一个计时器，默认2小时，如果连接建立，2小时内没有收到客户端的数据，服务端会发送探测报文，若还没有反应，则以每75分钟发送一个探测报文，发送10个探测报文之后没有反馈则会主动断开连接。</p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><blockquote>
<p><a href="https://blog.csdn.net/qzcsu/article/details/72861891" target="_blank" rel="noopener">https://blog.csdn.net/qzcsu/article/details/72861891</a></p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/uploads/avatar.jpeg"
                alt="小磊砸" />
            
              <p class="site-author-name" itemprop="name">小磊砸</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">29</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">26</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">小磊砸</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  

    
      <script id="dsq-count-scr" src="https://xiaoleiza.disqus.com/count.js" async></script>
    

    

  




	





  














  





  

  

  

  
  

  

  

  

</body>
</html>
