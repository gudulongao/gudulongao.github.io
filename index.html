<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="小磊砸的布劳格">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="小磊砸的布劳格">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="小磊砸的布劳格">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>小磊砸的布劳格</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">小磊砸的布劳格</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/01/java-5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小磊砸">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小磊砸的布劳格">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/07/01/java-5/" itemprop="url">函数式接口</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-07-01T23:07:32+08:00">
                2019-07-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java8/" itemprop="url" rel="index">
                    <span itemprop="name">java8</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/07/01/java-5/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/07/01/java-5/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>函数式接口(Functional interface)：有且仅有一个抽象方法（可以有多个非抽象方法）。</p>
<ul>
<li>函数式接口可以由lambda表达式实现(1.8以前都是通过匿名内部类来实现)</li>
<li>使用注解@FunctionalInterface 来启动函数式接口编译检查，同时会更新JavaDoc来表明当前接口是函数式接口</li>
</ul>
<p><img src="/2019/07/01/java-5/函数式接口.png" alt="函数式接口">  </p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><blockquote>
<p><a href="https://www.runoob.com/java/java8-functional-interfaces.html" target="_blank" rel="noopener">菜鸟教程：函数式接口</a><br><a href="https://blog.csdn.net/Keith003/article/details/80252172" target="_blank" rel="noopener">函数式接口</a>  </p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/01/java-4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小磊砸">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小磊砸的布劳格">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/07/01/java-4/" itemprop="url">方法引用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-07-01T21:53:55+08:00">
                2019-07-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java8/" itemprop="url" rel="index">
                    <span itemprop="name">java8</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/07/01/java-4/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/07/01/java-4/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>对于实例方法，我们通过对象来调用。对于静态方法，我们通过类名来调用。java8 提供了新的方式来更加简洁的调用方法。</p>
<h1 id="双冒号方法引用"><a href="#双冒号方法引用" class="headerlink" title="双冒号方法引用"></a>双冒号方法引用</h1><h2 id="构造函数引用"><a href="#构造函数引用" class="headerlink" title="构造函数引用"></a>构造函数引用</h2><p><img src="/2019/07/01/java-4/构造函数引用.png" alt="构造函数引用">  </p>
<ul>
<li>构造函数引用的格式是 <strong>Class::new</strong></li>
</ul>
<p>上图样例中的逻辑中采用了1.8新增的函数接口Supplier。该接口只有一个待实现方法get。接口包含泛型，get方法用于返回泛型类型的对象。</p>
<p><img src="/2019/07/01/java-4/Supplier接口源码.png" alt="Supplier">  </p>
<p>而函数式接口的意义在于其接口方法可以指向一个lambd表达式。就像前端中一个变量可以bindy到一个方法一样。样例中这个supplier=Print::new 就表明每次调用supplier的get方法时，实际在执行Print的构造函数。</p>
<h2 id="特定对象实例方法引用"><a href="#特定对象实例方法引用" class="headerlink" title="特定对象实例方法引用"></a>特定对象实例方法引用</h2><p><img src="/2019/07/01/java-4/实例方法引用.png" alt="实例方法方法引用">  </p>
<h2 id="静态方法引用"><a href="#静态方法引用" class="headerlink" title="静态方法引用"></a>静态方法引用</h2><p><img src="/2019/07/01/java-4/静态方法引用.png" alt="静态方法方法引用">  </p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><blockquote>
<p><a href="https://www.runoob.com/java/java8-method-references.html" target="_blank" rel="noopener">菜鸟教程：方法引用</a><br><a href="https://blog.csdn.net/Keith003/article/details/80252172" target="_blank" rel="noopener">函数式接口</a>  </p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/06/30/springboot-7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小磊砸">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小磊砸的布劳格">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/06/30/springboot-7/" itemprop="url">springboot 数据访问</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-06-30T16:32:19+08:00">
                2019-06-30
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/springboot/" itemprop="url" rel="index">
                    <span itemprop="name">springboot</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/06/30/springboot-7/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/06/30/springboot-7/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Spring-Data"><a href="#Spring-Data" class="headerlink" title="Spring Data"></a>Spring Data</h1><p>Spring Data是Spring用于解决数据访问问题的一系列解决方案。包含大量关系型数据库及非关系型数据库的数据访问解决方案。<br>Spring Data 提供统一的API来进行数据访问操作而屏蔽了不同数据存储技术的差异。Spring提供Spring Data Commons项目无论使用关系型数据库还是非关系型数据库，都能够有Spring的统一标准，该标准提供CRUD(创建，获取，更新和删除)、查询、排序和分页的相关操作。</p>
<h1 id="Spring-Data-REST"><a href="#Spring-Data-REST" class="headerlink" title="Spring Data REST"></a>Spring Data REST</h1><h1 id="声明事务"><a href="#声明事务" class="headerlink" title="声明事务"></a>声明事务</h1><h2 id="Spring-事物机制"><a href="#Spring-事物机制" class="headerlink" title="Spring 事物机制"></a>Spring 事物机制</h2><h2 id="声明事务-1"><a href="#声明事务-1" class="headerlink" title="声明事务"></a>声明事务</h2><h2 id="注解事务"><a href="#注解事务" class="headerlink" title="注解事务"></a>注解事务</h2><h1 id="缓存Cache"><a href="#缓存Cache" class="headerlink" title="缓存Cache"></a>缓存Cache</h1><h1 id="非关系型数据库NoSql"><a href="#非关系型数据库NoSql" class="headerlink" title="非关系型数据库NoSql"></a>非关系型数据库NoSql</h1><h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><blockquote>
<p>《SpringBoot实战》 汪云飞著<br><a href="https://www.jianshu.com/p/3b31270a44b1" target="_blank" rel="noopener">简书：SpringBoot2.0整合JPA</a>  </p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/06/19/springboot-6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小磊砸">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小磊砸的布劳格">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/06/19/springboot-6/" itemprop="url">springboot web开发</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-06-19T23:12:57+08:00">
                2019-06-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/springboot/" itemprop="url" rel="index">
                    <span itemprop="name">springboot</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/06/19/springboot-6/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/06/19/springboot-6/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Web相关配置"><a href="#Web相关配置" class="headerlink" title="Web相关配置"></a>Web相关配置</h1><p>在<strong>WebMvcAutoConfiguration</strong>源码中可以看到。SpringBoot提供了如下的自动配置。</p>
<h2 id="ViewResolver"><a href="#ViewResolver" class="headerlink" title="ViewResolver"></a>ViewResolver</h2><h3 id="ContentNegotiatingViewResolver"><a href="#ContentNegotiatingViewResolver" class="headerlink" title="ContentNegotiatingViewResolver"></a>ContentNegotiatingViewResolver</h3><p><img src="/2019/06/19/springboot-6/contentnegotiatingviewresolver.png" alt="ContentNegotiatingViewResolver">  </p>
<p>SpringMVC提供的特殊ViewResolver。ContentNegotiatingViewResolver不是自己处理View，而是代理给不同的ViewResolver来处理不同的View。<strong>其拥有最高的优先级</strong></p>
<h3 id="BeanNameViewResolver"><a href="#BeanNameViewResolver" class="headerlink" title="BeanNameViewResolver"></a>BeanNameViewResolver</h3><p><img src="/2019/06/19/springboot-6/beannameviewresolver.png" alt="BeanNameViewResolver">  </p>
<p>Controller的方法返回值的字符串会根据BeanNameViewResolver去查找Bean的名称返回字符串对应的View来渲染视图。</p>
<ol>
<li>Controller返回一个字符串。</li>
<li>根据字符串，在BeanNameViewResolver中寻找Bean的名称=字符串的Bean。</li>
<li>根据Bean来渲染视图</li>
</ol>
<h3 id="InternalResourceViewResolver"><a href="#InternalResourceViewResolver" class="headerlink" title="InternalResourceViewResolver"></a>InternalResourceViewResolver</h3><p><img src="/2019/06/19/springboot-6/internalresourcesviewresolver.png" alt="InternalResourcesViewResolver">  </p>
<p>最常用的ViewResolver。通过设置前缀、后缀，根据Controller方法返回的字符串来跳转到实际的视图。</p>
<h3 id="静态资源"><a href="#静态资源" class="headerlink" title="静态资源"></a>静态资源</h3><p><img src="/2019/06/19/springboot-6/addresourcehandlers.png" alt="addResourceHandler"><br><img src="/2019/06/19/springboot-6/static.png" alt="static">  </p>
<ul>
<li>自动将/META-INF/resources/webjars/下的镜头文件映射成/webjar/**</li>
<li>自动将classpath:/static、classpath:/public、classpath:/resources和/META-INF/resources 目录下的静态资源映射成/**</li>
</ul>
<h3 id="Formatter和Converter"><a href="#Formatter和Converter" class="headerlink" title="Formatter和Converter"></a>Formatter和Converter</h3><p><img src="/2019/06/19/springboot-6/addformatter.png" alt="addFormatter">  </p>
<p>从addFormatter(FormatterRegistry registry) 源码中可以看到</p>
<ul>
<li>自动加载Converter的实现类</li>
<li>自动加载GenericConverter的实现类</li>
<li>自动加载Formatter的实现类</li>
</ul>
<h2 id="接管SpringBoot的web配置"><a href="#接管SpringBoot的web配置" class="headerlink" title="接管SpringBoot的web配置"></a>接管SpringBoot的web配置</h2><h3 id="完全自定义配置"><a href="#完全自定义配置" class="headerlink" title="完全自定义配置"></a>完全自定义配置</h3><ul>
<li>@Configuration注解表明配置类</li>
<li>@EnableWebMvc 开启SpringMVC支持</li>
</ul>
<h3 id="拓展SpringBoot配置"><a href="#拓展SpringBoot配置" class="headerlink" title="拓展SpringBoot配置"></a>拓展SpringBoot配置</h3><ul>
<li>@Configuration注解表明配置类</li>
<li>继承自**WebMvcConfigurerAdapter，无需@EnableWebMvc注解。</li>
</ul>
<h2 id="注册Servlet、Filter和Listener"><a href="#注册Servlet、Filter和Listener" class="headerlink" title="注册Servlet、Filter和Listener"></a>注册Servlet、Filter和Listener</h2><h3 id="通过-Bean注解"><a href="#通过-Bean注解" class="headerlink" title="通过@Bean注解"></a>通过@Bean注解</h3><p>直接在配置类中通过@Bean注解来注册Servlet、Filter和Listener即可。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">public XXXServlet xxxServlet()&#123;</span><br><span class="line">  return new XXXServlet();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Bean</span><br><span class="line">public XXXFilter xxxFilter()&#123;</span><br><span class="line">  return new XXXFilter();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Bean</span><br><span class="line">public XXXListener xxxListener()&#123;</span><br><span class="line">  return new XXXListener();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="通过RegistrationBean"><a href="#通过RegistrationBean" class="headerlink" title="通过RegistrationBean"></a>通过RegistrationBean</h3><p>通过<strong>ServletRegistrationBean、FilterRegistrationBean和ListenerRegistrationBean</strong>来注册Servlet、Filter和Listener。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">public ServletRegistrationBean servletRegistrationBean()&#123;</span><br><span class="line">  return new ServletRegistrationBean(new XXXServlet(),&quot;/XX&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Bean</span><br><span class="line">public FilterRegistrationBean filterRegistrationBean()&#123;</span><br><span class="line">  FilterRegistrationBean registrationBean = new FilterRegistrationBean();</span><br><span class="line">  registrationBean.setFilter(new XXXFilter());</span><br><span class="line">  registrationBean.setOrder(2);</span><br><span class="line">  return registrationBean;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Bean</span><br><span class="line">public ServletListenerRegistrationBean&lt;XXXListener&gt; xxxlistenerRegistrationBean()&#123;</span><br><span class="line">  return new ServeletListenerRegistrationBean&lt;XXXListener&gt;(new XXXListener());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Tomcat配置"><a href="#Tomcat配置" class="headerlink" title="Tomcat配置"></a>Tomcat配置</h1><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>SpringBoot针对servlet容器的配置对应的bean在org.springframework.boot.autoconfigure.web.ServerProperties。</p>
<p><img src="/2019/06/19/springboot-6/serverproperties.png" alt="ServerProperties">  </p>
<p><strong>从源码中可以看到，容器通用配置的前缀是server。针对不同的Servlet容器，以tomcat为例，特殊配置前缀为server.tomcat</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 通用容器配置</span><br><span class="line">server.port</span><br><span class="line">server.session-timeout</span><br><span class="line">server.context-path</span><br><span class="line"># tomcat特殊配置</span><br><span class="line">server.tomcat.uri-encoding</span><br><span class="line">server.tomcat.compression</span><br></pre></td></tr></table></figure>
<h2 id="代码配置"><a href="#代码配置" class="headerlink" title="代码配置"></a>代码配置</h2><ul>
<li>通用容器配置，注册<strong>EmbeddedServletContainerCustomizer</strong></li>
<li>配置Tomcat、Jetty和Undertow特殊配置。分别注册<strong>TomcatEmbeddedServletContainerFactory、JettyEmbeddedServletContainerFactory和UndertowEmbeddedContainerFactory。</strong></li>
</ul>
<p>目前本地环境使用的版本已找不到对应的类，通过查阅资料，发现是通过<strong>WebServerFactoryCustomizer</strong>来配置通用配置。通过<strong>TomcatServletWebServerFactoryCustomizer</strong>来配置Tomcat特殊配置。</p>
<p><img src="/2019/06/19/springboot-6/tomcat.png" alt="Tomcat">  </p>
<h2 id="替换Tomcat"><a href="#替换Tomcat" class="headerlink" title="替换Tomcat"></a>替换Tomcat</h2><p><strong>SpringBoot默认采用Tomcat作为Servlet容器</strong><br>如果想要替换Tomcat，需要在starter中排除starter-tomcat再依赖starter-jetty/starter-undertow即可。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">     &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">     &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">     &lt;exclusions&gt;</span><br><span class="line">         &lt;exclusion&gt;</span><br><span class="line">             &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">             &lt;artifactId&gt;spring-boot-starter-tomcat&lt;/artifactId&gt;</span><br><span class="line">         &lt;/exclusion&gt;</span><br><span class="line">     &lt;/exclusions&gt;</span><br><span class="line"> &lt;/dependency&gt;</span><br><span class="line"> &lt;dependency&gt;</span><br><span class="line">     &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">     &lt;artifactId&gt;spring-boot-starter-jetty&lt;/artifactId&gt;</span><br><span class="line"> &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<h2 id="SSL配置"><a href="#SSL配置" class="headerlink" title="SSL配置"></a>SSL配置</h2><p>SSL(Secure Sockets Layer)安全套接层。是为网络通信提供安全及数据完整性的一种安全协议。<br>SSL可分为两层：<strong>SSL记录洗衣和SSL握手协议</strong>。</p>
<table>
<thead>
<tr>
<th>协议</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>SSL记录协议(SSL Record Protool)</td>
<td>建立在可靠的传输协议如TCP之上，为高层协议提供数据封装、压缩加密等基本功能的支持</td>
</tr>
<tr>
<td>SSL握手协议(SSL Handshake Protool)</td>
<td>建立在SSL记录协议之上，用于在实际数据传输开始前，通信双方进行身份认证、协商加密算法，交换加密密钥等</td>
</tr>
</tbody>
</table>
<p><strong>B/S的web应用中，HTTPS来实现SSL。HTTPS是以安全为目标的HTTP通道。即在HTTP下加入SSL层。</strong> </p>
<h3 id="生成证书"><a href="#生成证书" class="headerlink" title="生成证书"></a>生成证书</h3><p>使用SSL首先需要证书证书可以是自签名的，也可以是从SSL证书授权中心获取，演示通过自签名的方式来生成正式。</p>
<p><img src="/2019/06/19/springboot-6/keytool.png" alt="keytool"></p>
<p>通过JDK自带的工具keytool在当前目录来生成.keystore 证书。  </p>
<h3 id="配置SSL"><a href="#配置SSL" class="headerlink" title="配置SSL"></a>配置SSL</h3><p>在application.properties中引入容器SSL的配置。</p>
<p><img src="/2019/06/19/springboot-6/sslconf.png" alt="容器SSL配置"></p>
<p>启动日志</p>
<p><img src="/2019/06/19/springboot-6/sslstartlog.png" alt="启动日志"></p>
<h3 id="http专项https"><a href="#http专项https" class="headerlink" title="http专项https"></a>http专项https</h3><p>我们访问http端口的时候自动将请求转发到https的端口。需要通过代码来配置tomcat。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">public ConfigurableServletWebServerFactory configurableServletWebServerFactory() &#123;</span><br><span class="line">    TomcatServletWebServerFactory tomcat = new TomcatServletWebServerFactory() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        protected void postProcessContext(Context context) &#123;</span><br><span class="line">            SecurityConstraint securityConstraint = new SecurityConstraint();</span><br><span class="line">            securityConstraint.setUserConstraint(&quot;CONFIDENTIAL&quot;);</span><br><span class="line">            SecurityCollection collection = new SecurityCollection();</span><br><span class="line">            collection.addPattern(&quot;/*&quot;);</span><br><span class="line">            securityConstraint.addCollection(collection);</span><br><span class="line">            context.addConstraint(securityConstraint);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    tomcat.addAdditionalTomcatConnectors(buildHttpConnector());</span><br><span class="line">    return tomcat;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private Connector buildHttpConnector() &#123;</span><br><span class="line">    Connector connector = new Connector(&quot;org.apache.coyote.http11.Http11NioProtocol&quot;);</span><br><span class="line">    connector.setScheme(&quot;http&quot;);</span><br><span class="line">    //设置http 端口</span><br><span class="line">    connector.setPort(80);</span><br><span class="line">    connector.setSecure(false);</span><br><span class="line">    //设置https 端口</span><br><span class="line">    connector.setRedirectPort(8080);</span><br><span class="line">    return connector;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2019/06/19/springboot-6/autoredirct.png" alt="http自动跳转https"></p>
<h1 id="Favicon配置"><a href="#Favicon配置" class="headerlink" title="Favicon配置"></a>Favicon配置</h1><p>Favicon是SpringBoot页面标签页的图标。SpringBoot默认会提供一个标签，也可以个性化定制或者关闭。</p>
<h2 id="关闭Favicon"><a href="#关闭Favicon" class="headerlink" title="关闭Favicon"></a>关闭Favicon</h2><p>在application.properties中可以关闭，默认开启</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># favicon</span><br><span class="line">spring.mvc.favicon.enabled=false</span><br></pre></td></tr></table></figure>
<h2 id="个性化Favicon"><a href="#个性化Favicon" class="headerlink" title="个性化Favicon"></a>个性化Favicon</h2><p>将图标命名为favicon.ico(必须这个名称)。放到classpath:META-INF/resources,classpath:resources/,classpath:static/,classpath:public/这几个目录任意目录下即可。</p>
<h1 id="WebSocket"><a href="#WebSocket" class="headerlink" title="WebSocket"></a>WebSocket</h1><ul>
<li>WebSocket 为浏览器与服务器之间提供了双工异步的通信功能。WebSocket需要浏览器支持，如IE10+、Chrome13+、FireFox6+都已支持。  </li>
<li>WebSocket是通过一个Socket来实现双工异步通信能力的。直接使用WebSocket协议进行开发会特别的繁琐，实际会使用较WebSocket协议更加高级的子协议STOMP，基于帧格式来定义信息与http的request和response类似的方式来进行开发。  </li>
<li>SpringBoot为WebSocket提供的starter是spring-boot-starter-websocket。</li>
</ul>
<p><img src="springboot-6/http和websocket.png" alt="http和websocket"></p>
<h2 id="引入websocket支持"><a href="#引入websocket支持" class="headerlink" title="引入websocket支持"></a>引入websocket支持</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-websocket&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<h2 id="开启WebSocket支持"><a href="#开启WebSocket支持" class="headerlink" title="开启WebSocket支持"></a>开启WebSocket支持</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@Configuration</span><br><span class="line">@EnableScheduling</span><br><span class="line">public class WebSocketConfiguration &#123;</span><br><span class="line">    @Bean</span><br><span class="line">    public ServerEndpointExporter serverEndpointExporter() &#123;</span><br><span class="line">        return new ServerEndpointExporter();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>声明Bean ServerEndpointExporter来开启对WebSocket的支持</p>
<h2 id="WebSocketServer"><a href="#WebSocketServer" class="headerlink" title="WebSocketServer"></a>WebSocketServer</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@Component</span><br><span class="line">@ServerEndpoint(&quot;/websocket&quot;)</span><br><span class="line">public class WebSocketServer &#123;</span><br><span class="line">    private static Logger log = LoggerFactory.getLogger(WebSocketServer.class);</span><br><span class="line"></span><br><span class="line">    private static CopyOnWriteArrayList&lt;WebSocketServer&gt; queue = new CopyOnWriteArrayList&lt;&gt;();</span><br><span class="line">    private static Integer count = 0;</span><br><span class="line">    private Session session;</span><br><span class="line">    boolean isOpen;</span><br><span class="line"></span><br><span class="line">    @OnOpen</span><br><span class="line">    public void open(Session session) &#123;</span><br><span class="line">        this.isOpen = true;</span><br><span class="line">        this.session = session;</span><br><span class="line">        queue.add(this);</span><br><span class="line">        addCount();</span><br><span class="line">        log.info(&quot;open... count: &quot; + count);</span><br><span class="line">        pushMessage(&quot;hello&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @OnClose</span><br><span class="line">    public void close(Session session) &#123;</span><br><span class="line">        this.isOpen = false;</span><br><span class="line">        queue.remove(this);</span><br><span class="line">        deCount();</span><br><span class="line">        log.info(&quot;close! count: &quot; + count);</span><br><span class="line">        pushMessage(&quot;goodbye&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @OnMessage</span><br><span class="line">    public void reciveMessage(String message, Session session) &#123;</span><br><span class="line">        log.info(&quot;recive messaeg: &quot; + message);</span><br><span class="line">        for (WebSocketServer server : queue) &#123;</span><br><span class="line">            server.pushMessage(message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @OnError</span><br><span class="line">    public void error(Session session, Throwable e) &#123;</span><br><span class="line">        log.error(e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static synchronized void addCount() &#123;</span><br><span class="line">        count = count + 1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static synchronized void deCount() &#123;</span><br><span class="line">        count = count - 1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 推送消息</span><br><span class="line">     *</span><br><span class="line">     * @param mess</span><br><span class="line">     */</span><br><span class="line">    private void pushMessage(String mess) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            if (isOpen) &#123;</span><br><span class="line">                this.session.getBasicRemote().sendText(mess);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 给所有连接推送消息</span><br><span class="line">     *</span><br><span class="line">     * @param mess</span><br><span class="line">     */</span><br><span class="line">    public void push2AllSession(String mess) &#123;</span><br><span class="line">        for (WebSocketServer server : queue) &#123;</span><br><span class="line">            if (server.isOpen) &#123;</span><br><span class="line">                server.pushMessage(mess);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="WebSocketController"><a href="#WebSocketController" class="headerlink" title="WebSocketController"></a>WebSocketController</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">@Controller</span><br><span class="line">public class WebSocketController &#123;</span><br><span class="line">    @Autowired</span><br><span class="line">    private WebSocketServer server;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(&quot;/websocket&quot;)</span><br><span class="line">    public String init() &#123;</span><br><span class="line">        return &quot;websocket.html&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Scheduled(fixedDelay = 5000)</span><br><span class="line">    public void fixDelay() &#123;</span><br><span class="line">        Date date = new Date();</span><br><span class="line">        server.push2AllSession(&quot;time: &quot; + date.toString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public WebSocketServer getServer() &#123;</span><br><span class="line">        return server;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setServer(WebSocketServer server) &#123;</span><br><span class="line">        this.server = server;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="WebSocket-html"><a href="#WebSocket-html" class="headerlink" title="WebSocket.html"></a>WebSocket.html</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;My WebSocket Test&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;input id=&quot;text&quot; type=&quot;text&quot;/&gt;</span><br><span class="line">&lt;button onclick=&quot;send()&quot;&gt;Send&lt;/button&gt;</span><br><span class="line">&lt;button onclick=&quot;closeWebSocket()&quot;&gt;Close&lt;/button&gt;</span><br><span class="line">&lt;div id=&quot;message&quot;&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">    var websocket = null;</span><br><span class="line"></span><br><span class="line">    //判断当前浏览器是否支持WebSocket</span><br><span class="line">    if (&apos;WebSocket&apos; in window) &#123;</span><br><span class="line">        websocket = new WebSocket(&quot;ws://localhost:8080/demo/websocket&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    else &#123;</span><br><span class="line">        alert(&apos;Not support websocket&apos;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //连接发生错误的回调方法</span><br><span class="line">    websocket.onerror = function () &#123;</span><br><span class="line">        setMessageInnerHTML(&quot;error&quot;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    //连接成功建立的回调方法</span><br><span class="line">    websocket.onopen = function (event) &#123;</span><br><span class="line">        setMessageInnerHTML(&quot;open&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //接收到消息的回调方法</span><br><span class="line">    websocket.onmessage = function (event) &#123;</span><br><span class="line">        setMessageInnerHTML(event.data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //连接关闭的回调方法</span><br><span class="line">    websocket.onclose = function () &#123;</span><br><span class="line">        setMessageInnerHTML(&quot;close&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //监听窗口关闭事件，当窗口关闭时，主动去关闭websocket连接，防止连接还没断开就关闭窗口，server端会抛异常。</span><br><span class="line">    window.onbeforeunload = function () &#123;</span><br><span class="line">        websocket.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //将消息显示在网页上</span><br><span class="line">    function setMessageInnerHTML(innerHTML) &#123;</span><br><span class="line">        document.getElementById(&apos;message&apos;).innerHTML += innerHTML + &apos;&lt;br/&gt;&apos;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //关闭连接</span><br><span class="line">    function closeWebSocket() &#123;</span><br><span class="line">        websocket.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //发送消息</span><br><span class="line">    function send() &#123;</span><br><span class="line">        var message = document.getElementById(&apos;text&apos;).value;</span><br><span class="line">        websocket.send(message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><blockquote>
<p>《SpringBoot实战》 汪云飞著<br><a href="https://blog.csdn.net/j080624/article/details/80677337" target="_blank" rel="noopener">WebJars简介</a><br><a href="https://blog.csdn.net/hemin1003/article/details/91991433" target="_blank" rel="noopener">SpringBoot2.1.3代码配置Tomcat</a><br><a href="https://blog.csdn.net/xiaoming100001/article/details/81109617" target="_blank" rel="noopener">http与https</a><br><a href="https://blog.51cto.com/11883699/2160032" target="_blank" rel="noopener">https与CA证书申请</a><br><a href="https://blog.csdn.net/moshowgame/article/details/80275084" target="_blank" rel="noopener">http与websocket及SpringBoot2.0实现WebSocket简单样例</a><br><a href="https://blog.csdn.net/ffj0721/article/details/82630134" target="_blank" rel="noopener">SpringBoot2.0实现WebSocket</a>   </p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/06/18/springboot-5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小磊砸">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小磊砸的布劳格">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/06/18/springboot-5/" itemprop="url">springboot 核心</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-06-18T21:56:30+08:00">
                2019-06-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/springboot/" itemprop="url" rel="index">
                    <span itemprop="name">springboot</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/06/18/springboot-5/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/06/18/springboot-5/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="基本配置"><a href="#基本配置" class="headerlink" title="基本配置"></a>基本配置</h1><h2 id="SpringBootApplication"><a href="#SpringBootApplication" class="headerlink" title="@SpringBootApplication"></a>@SpringBootApplication</h2><p>SpringBoot项目支持通过Jar包的方式运行，所以需要有入口类，即main方法的类。同时SpringBoot项目会在入口类中运行项目。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@SpringBootApplication</span><br><span class="line">public class SpringdemoApplication &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(SpringdemoApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>SpringDemoApplication就是项目的入口类，同时在main方法中通过SpringApplication来运行有@SpringBootApplication修饰的类。</p>
<p><img src="/2019/06/18/springboot-5/springbootapplication注解.png" alt="注解@SpringBootApplication">  </p>
<p>从@SpringBootApplication注解的源码中可以看到，其是一个组合注解，包含@ComponentScan、@EnableAutoConfiguration、@Configuration等注解的功能。<br>其中<strong>@EnableAutoConfiguration能够让SpringBoot项目根据classpath中的jar包依赖为项目自动管理bean，建议入口类的位置在groupId+arctifactID组合的包下</strong>。  </p>
<p>如果不想关闭某些类的自动配置可以使用@SpringBootApplication的exclude属性。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@SpringBootApplication(exclude = DemoController.class)</span><br></pre></td></tr></table></figure>
<p><strong>这样spring就不会根据classpath的依赖来自动配置了，这里需要说明的是，配置的意思是自动管理有@Configuration注解的配置类</strong>。所以上面的样例中排出的DemoController是没有意义的，启动还会报错提示并不是配置类.</p>
<h2 id="定制Banner"><a href="#定制Banner" class="headerlink" title="定制Banner"></a>定制Banner</h2><p>Banner就是SpringBoot项目启动时的图案。</p>
<p><img src="/2019/06/18/springboot-5/defaultbanner.png" alt="默认banner">  </p>
<p>可以在<a href="http://patorjk.com/software/taag" target="_blank" rel="noopener">定制banner</a> 来定制banner图案，并将网站生成的内容保存到src/main/java/resources/banner.txt中即可。</p>
<p><img src="/2019/06/18/springboot-5/mybanner.png" alt="个性化banner">  </p>
<p>这个有点意思。如果resources下有banner.txt，则会走banner.txt指定的内容作为banner输出，如果没有，可以在SpringApplication#setBanner方法中自定义输出内容来作为banner输出。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">@SpringBootApplication</span><br><span class="line">public class SpringdemoApplication &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication application = new SpringApplication(SpringdemoApplication.class);</span><br><span class="line">//        application.setBannerMode(Mode.OFF);</span><br><span class="line">        application.setBanner(new Banner() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void printBanner(Environment environment, Class&lt;?&gt; sourceClass, PrintStream out) &#123;</span><br><span class="line">                out.print(&quot;阿西吧阿西吧阿西吧阿西吧阿西吧阿西吧&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        application.run();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2019/06/18/springboot-5/setbanner.png" alt="setBanner">  </p>
<p><img src="/2019/06/18/springboot-5/loadbannerorder.png" alt="加载banner的顺序">  </p>
<p>从SpringApplicationBannerPrinter的源码中可以看到，加载Banner的顺序是先找图片类型，再找txt，其次再找fallbackbanner，最后没有就是系统默认的。</p>
<h3 id="关闭Banner"><a href="#关闭Banner" class="headerlink" title="关闭Banner"></a>关闭Banner</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@SpringBootApplication</span><br><span class="line">public class SpringdemoApplication &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">//        SpringApplication.run(SpringdemoApplication.class, args);</span><br><span class="line">        //方式1</span><br><span class="line">        SpringApplication application = new SpringApplication(SpringdemoApplication.class);</span><br><span class="line">        application.setBannerMode(Mode.OFF);</span><br><span class="line">        application.run();</span><br><span class="line">        //方式2</span><br><span class="line">        new SpringApplicationBuilder(SpringdemoApplication.class).bannerMode(Mode.OFF).run();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><p>SpringBoot项目全局默认的配置文件是位于src/main/resources目录下的application.properties或者application.yml。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">server.port=8080</span><br><span class="line">server.address=localhost</span><br><span class="line">server.servlet.context-path=/demo</span><br></pre></td></tr></table></figure>
<h2 id="SpringBoot常用注解"><a href="#SpringBoot常用注解" class="headerlink" title="SpringBoot常用注解"></a>SpringBoot常用注解</h2><h1 id="加载配置"><a href="#加载配置" class="headerlink" title="加载配置"></a>加载配置</h1><h2 id="Value"><a href="#Value" class="headerlink" title="@Value"></a>@Value</h2><p>前面Spring基础功能中有讲过@Value注解，结合@PropertySource来指定配置文件的路径，通过@Value来加载配置文件中对应key的值。<br><strong>通过@Value注解结合SpringBoot来使用，会默认从application.properties中来读取配置</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">public class DemoController &#123;</span><br><span class="line">    @Value(&quot;$&#123;test.name&#125;&quot;)</span><br><span class="line">    private String name;</span><br><span class="line">    @Value(&quot;$&#123;test.age&#125;&quot;)</span><br><span class="line">    private String age;</span><br><span class="line">    @Value(&quot;$&#123;test.address&#125;&quot;)</span><br><span class="line">    private String address;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(&quot;/&quot;)</span><br><span class="line">    public String hello() &#123;</span><br><span class="line">        return &quot;name: &quot; + this.name + &quot; age: &quot; + age + &quot; address: &quot; + this.address;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>application.properties内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">test.name=axiba</span><br><span class="line">test.age=12</span><br><span class="line">test.address=beijing</span><br></pre></td></tr></table></figure>
<p>访问页面  </p>
<p><img src="/2019/06/18/springboot-5/@value.png" alt="注解@Value">  </p>
<h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><p>对于配置无法自动类型匹配，只能将配置项读取为字符串，不是很方便，同时配置项多的场景每一个配置项都需要通过代码来指定，很繁琐</p>
<h2 id="ConfigurationProperties"><a href="#ConfigurationProperties" class="headerlink" title="@ConfigurationProperties"></a>@ConfigurationProperties</h2><p>通过@ConfigurationProperties我们可以将配置文件中的配置项直接与bean进行对应，这样SpringBoot可以帮忙自动将配置转换成bean。</p>
<p><img src="/2019/06/18/springboot-5/ConfigurationProperties源码.png" alt="注解@ConfigurationProperites源码">  </p>
<p>从@ConfigurationProperties注解的源码可以看到，可以通过prefix来指定涉及加载配置项的前缀。</p>
<h3 id="样例"><a href="#样例" class="headerlink" title="样例"></a>样例</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">@ConfigurationProperties(prefix = &quot;test&quot;)</span><br><span class="line">public class TestBean &#123;</span><br><span class="line">    private String name;</span><br><span class="line">    private int age;</span><br><span class="line">    private String address;</span><br><span class="line"></span><br><span class="line">    public String getName() &#123;</span><br><span class="line">        return name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setName(String name) &#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int getAge() &#123;</span><br><span class="line">        return age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setAge(int age) &#123;</span><br><span class="line">        this.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getAddress() &#123;</span><br><span class="line">        return address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setAddress(String address) &#123;</span><br><span class="line">        this.address = address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;TestBean&#123;&quot; +</span><br><span class="line">                &quot;name=&apos;&quot; + name + &apos;\&apos;&apos; +</span><br><span class="line">                &quot;, age=&quot; + age +</span><br><span class="line">                &quot;, address=&apos;&quot; + address + &apos;\&apos;&apos; +</span><br><span class="line">                &apos;&#125;&apos;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@RestController</span><br><span class="line">public class DemoController &#123;</span><br><span class="line">    @Value(&quot;$&#123;test.name&#125;&quot;)</span><br><span class="line">    private String name;</span><br><span class="line">    @Value(&quot;$&#123;test.age&#125;&quot;)</span><br><span class="line">    private String age;</span><br><span class="line">    @Value(&quot;$&#123;test.address&#125;&quot;)</span><br><span class="line">    private String address;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private TestBean testBean;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(&quot;/&quot;)</span><br><span class="line">    public String hello() &#123;</span><br><span class="line">        return &quot;name: &quot; + this.name + &quot; age: &quot; + age + &quot; address: &quot; + this.address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(&quot;/test&quot;)</span><br><span class="line">    public String testSetting() &#123;</span><br><span class="line">        return testBean.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>访问页面请求  </p>
<p><img src="/2019/06/18/springboot-5/@ConfigruationProperties.png" alt="注解@ConfigurationProperties">  </p>
<h1 id="日志配置"><a href="#日志配置" class="headerlink" title="日志配置"></a>日志配置</h1><p>Springboot支持Java Util Logging，Log4J，Log4J2和LogBack作为日志框架，并且SpringBoot已提供了控制台暑促好和文件输出的默认配置。<br>如果需要个性定制可以直接在application.properties中添加。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logging.level.root=debug</span><br></pre></td></tr></table></figure>
<h1 id="Profile配置"><a href="#Profile配置" class="headerlink" title="Profile配置"></a>Profile配置</h1><p>针对不同的环境下提供不同的配置。可以采用Spring的Profile机制。</p>
<ul>
<li>提供application-{profile}.properties配置文件</li>
<li>在application.properties中通过spring.profile.active=${profile}来选择激活的配置文件</li>
</ul>
<h1 id="运行原理"><a href="#运行原理" class="headerlink" title="运行原理"></a>运行原理</h1><p>Spring 4.X支持条件注解@Condition来配置Bean。SpringBoot的自动配置也是源自于此。<br>SpringBoot项目自动配置的源码在<strong>spring-boot-autoconfigure-XX.jar</strong>中。</p>
<h2 id="自动配置报告"><a href="#自动配置报告" class="headerlink" title="自动配置报告"></a>自动配置报告</h2><p>可以在运行jar的时候采用启动参数来开启</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar XXX.jar --debug</span><br></pre></td></tr></table></figure>
<p>也可以在application.properties中配置来开启</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 自动配置和未自动配置的报告</span><br><span class="line">debug=true</span><br></pre></td></tr></table></figure>
<p><img src="/2019/06/18/springboot-5/debugreport.png" alt="自动配置报告">  </p>
<h2 id="运作原理"><a href="#运作原理" class="headerlink" title="运作原理"></a>运作原理</h2><p><img src="/2019/06/18/springboot-5/SpringBootApplication.png" alt="@SpringBootApplication源码">  </p>
<p>从注解@SpringBootApplication的源码中可以看到，其包含注解@EnableConfiguration。</p>
<p><img src="/2019/06/18/springboot-5/EnableAutoConfiguration.png" alt="EnableAutoConfiguration源码">  </p>
<p>从注解@EnableAutoConfiguration的源码中可以看到，其通过@Import注解加入了AutoCOnfigurationImportSelector。这里@Import注解的作用是将非当前Ioc容器的Bean或者配置类引入到容器中。这里相当于引入了bean AutoConfigurationImportSelelctor。</p>
<p><img src="/2019/06/18/springboot-5/AutoConfigurationImportSelector.png" alt="AutoConfigurationImportSelector源码">  </p>
<p>从AutoConfigurationImportSelector的源码中可以看到，通过SpringFactoriesLoader来加载了配置信息。</p>
<p><img src="/2019/06/18/springboot-5/SpringFactoriesLoader.png" alt="SpringFactoriesLoader源码">  </p>
<p>从SpringFactoriesLoader的源码中可以看到，其会加重classpath路径下jar包中<strong>META-INFO/spring.factories文件。即SpringBoot自动配置的含义是采用@SpringBootApplication注解后，会自动配置classpath路径下jar包张中包含META-INF/spring.factories文件。</strong></p>
<p>在spring-boot-autoconfigure-XX.jar中就包含自动配置的文件META-INF/spring.factories。</p>
<p><img src="/2019/06/18/springboot-5/factories.png" alt="spring.factories文件">  </p>
<h2 id="核心注解"><a href="#核心注解" class="headerlink" title="核心注解"></a>核心注解</h2><p><img src="/2019/06/18/springboot-5/AopAutoConfiguration.png" alt="AopAutoConfiguration源码">  </p>
<p>随意打开spring.factories文件中配置的**AutoConfiguration源码，可以看到很多的注解，这些注解说明如下：</p>
<table>
<thead>
<tr>
<th>注解</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>@ConditionalOnBean</td>
<td>当容器中包含条件的bean时生效</td>
</tr>
<tr>
<td>@ConditionalOnMissingBean</td>
<td>当容器中不包含指定的Bean时生效</td>
</tr>
<tr>
<td>@ConditionalOnClass</td>
<td>当classpath下有指定的类时生效</td>
</tr>
<tr>
<td>@ConditionalOnMissingClass</td>
<td>当classpath下不包含指定的class时生效</td>
</tr>
<tr>
<td>@ConditionalOnExpression</td>
<td>基于<a href="https://www.cnblogs.com/moonlightpoet/p/5541010.html" target="_blank" rel="noopener">SpEL表达式</a>作为条件，满足时生效</td>
</tr>
<tr>
<td>@ConditionalOnJava</td>
<td>基于JVM版本为条件，满足时生效</td>
</tr>
<tr>
<td>@ConditionalOnJndi</td>
<td>在JNDI存在的条件下查找指定位置</td>
</tr>
<tr>
<td>@ConditionalOnWebApplication</td>
<td>当前项目是web项目时生效</td>
</tr>
<tr>
<td>@ConditionalOnNotWebApplication</td>
<td>当前项目不是web项目时生效</td>
</tr>
<tr>
<td>@ConditionalOnProperty</td>
<td>指定的属性有指定的值时生效</td>
</tr>
<tr>
<td>@ConditionalOnResource</td>
<td>classpath下有指定的值时生效</td>
</tr>
<tr>
<td>@ConditionalOnSingleCandidate</td>
<td>当前容器中只有指定的一个bean，或者有多个时指定的是首选的情况下生效</td>
</tr>
</tbody>
</table>
<h2 id="自动配置编码的filter"><a href="#自动配置编码的filter" class="headerlink" title="自动配置编码的filter"></a>自动配置编码的filter</h2><p>非SpringBoot项目设置http编码是在web.xml中配置filter</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;filter&gt;</span><br><span class="line">  &lt;filter-name&gt;encodingfilter&lt;/filter-name&gt;</span><br><span class="line">  &lt;filter-class&gt;org.springframework.web.filter.CharacterEncodingFilter&lt;/filter-class&gt;</span><br><span class="line">  &lt;init-param&gt;</span><br><span class="line">    &lt;param-name&gt;encoding&lt;/param-name&gt;</span><br><span class="line">    &lt;param-value&gt;UTF-8&lt;/param-value&gt;</span><br><span class="line">  &lt;/init-param&gt;</span><br><span class="line">  &lt;init-param&gt;</span><br><span class="line">    &lt;param-name&gt;foreEncoding&lt;/param-name&gt;</span><br><span class="line">    &lt;param-value&gt;true&lt;/param-value&gt;</span><br><span class="line">  &lt;/init-param&gt;</span><br><span class="line">&lt;/filter&gt;</span><br></pre></td></tr></table></figure>
<p>下面采用SpringBoot自动配置的思路，我们通过注解来自动配置</p>
<p>在application.properties中添加配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># http编码</span><br><span class="line">spring.http.encoding.charset=UTF-8</span><br><span class="line">spring.http.encoding.force=true</span><br></pre></td></tr></table></figure>
<p>基于注解@ConfigurationProperties来创建与配置对应的配置bean</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">@ConfigurationProperties(prefix = &quot;spring.http.encoding&quot;)</span><br><span class="line">public class EncodeFilterConf &#123;</span><br><span class="line">    private static final Charset DEFAULT_CHARSET = Charset.forName(&quot;UTF-8&quot;);</span><br><span class="line">    private Charset charset = DEFAULT_CHARSET;</span><br><span class="line">    private boolean force;</span><br><span class="line"></span><br><span class="line">    public Charset getCharset() &#123;</span><br><span class="line">        return charset;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setCharset(Charset charset) &#123;</span><br><span class="line">        this.charset = charset;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public boolean isForce() &#123;</span><br><span class="line">        return force;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setForce(boolean force) &#123;</span><br><span class="line">        this.force = force;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>基于条件注解来增加配置类</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">@EnableConfigurationProperties(EncodeFilterConf.class)</span><br><span class="line">@ConditionalOnClass(CharacterEncodingFilter.class)</span><br><span class="line">@ConditionalOnProperty(prefix = &quot;spring.http.encoding&quot;, value = &quot;enable&quot;, matchIfMissing = true)</span><br><span class="line">public class EncodeFilterAutoConfiguration &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    protected EncodeFilterConf conf;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    @ConditionalOnMissingBean(CharacterEncodingFilter.class)</span><br><span class="line">    public CharacterEncodingFilter characterEncodingFilter() &#123;</span><br><span class="line">        CharacterEncodingFilter filter = new CharacterEncodingFilter();</span><br><span class="line">        filter.setEncoding(conf.getCharset().name());</span><br><span class="line">        filter.setForceEncoding(conf.isForce());</span><br><span class="line">        return filter;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>@EnbaleConfigurationProperties注解中指定了EncodeFilterConf，即如果有bean是与配置对应通过@ConfigurationProperties来生成的，则必须通过@EnableConfigurationProperties来指定，否则容器无法自动装载使用注解@ConfigurationProperties的类，<strong>即@EnableConfigurationProperites是为了使@ConfigurationProperties注解生效</strong></li>
<li>@ConditionOnProperty是指配置文件中有配置项spring.http.encoding。并且配置的值是enable，matchIfMissing的意思是如果没有配置这些配置，条件也算成立，即该条件注解中涉及的配置项没有配置也算成立。</li>
</ul>
<p>最终可以在自动配置报告中查看该配置类是否自动配置。</p>
<p><img src="/2019/06/18/springboot-5/自动配置.png" alt="自动配置报告">  </p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><blockquote>
<p>《SpringBoot实战》 汪云飞著<br><a href="https://blog.csdn.net/pange1991/article/details/81356594" target="_blank" rel="noopener">@Import注解的说明</a><br><a href="https://www.cnblogs.com/moonlightpoet/p/5541010.html" target="_blank" rel="noopener">SpEL表达式说明</a><br><a href="https://www.jianshu.com/p/7f54da1cb2eb" target="_blank" rel="noopener">@EnableConfigurationProperties注解说明</a>  </p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/06/17/springboot-4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小磊砸">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小磊砸的布劳格">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/06/17/springboot-4/" itemprop="url">springboot 基础</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-06-17T21:30:07+08:00">
                2019-06-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/springboot/" itemprop="url" rel="index">
                    <span itemprop="name">springboot</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/06/17/springboot-4/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/06/17/springboot-4/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="SpringBoot概述"><a href="#SpringBoot概述" class="headerlink" title="SpringBoot概述"></a>SpringBoot概述</h1><h2 id="SpringBoot核心功能"><a href="#SpringBoot核心功能" class="headerlink" title="SpringBoot核心功能"></a>SpringBoot核心功能</h2><ul>
<li>SpringBoot项目可以采用jar包运行:可以直接通过jar -jar 来运行。</li>
<li>内嵌Servlet容器：内嵌的Servlet可以选择Jetty,Tomcat和Unertow，无需war包部署。</li>
<li>使用starter来简化maven配置:Spring提供一系列的starter pom来简化maven配置。</li>
<li>自动配置Spring：SpringBoot会根据classpath中的jar包，类，为jar包中的类自动配置bean。</li>
<li>应用监控：SpringBoot提供基于http/ssh/telnet对运行时项目进行监控。</li>
<li>无代码生成以及XML配置：SpringBoot的这些便捷功能都是通过条件注解来实现的，并且SpringBoot提倡通过注解和java配置来组合实现功能，不需要任何xml配置。</li>
</ul>
<h2 id="SpringBoot优点"><a href="#SpringBoot优点" class="headerlink" title="SpringBoot优点"></a>SpringBoot优点</h2><ul>
<li>快速构建项目</li>
<li>对主流的开发框架无配置的集成</li>
<li>项目可以独立运行，无需外部的Servlet容器</li>
<li>支持运行时的应用监控</li>
<li>与云计算的天然集成</li>
<li>极大提高了开发、部署的效率</li>
</ul>
<h1 id="SpringBoot快速搭建"><a href="#SpringBoot快速搭建" class="headerlink" title="SpringBoot快速搭建"></a>SpringBoot快速搭建</h1><h2 id="基于网页"><a href="#基于网页" class="headerlink" title="基于网页"></a>基于网页</h2><p>Spring提供基于网页：<a href="http://start.spring.io" target="_blank" rel="noopener">http://start.spring.io</a> 来通过交互的方式快速生成项目工程</p>
<p><img src="/2019/06/17/springboot-4/startbypage.png" alt="通过网页来生成项目工程">  </p>
<p><img src="/2019/06/17/springboot-4/demoproject.png" alt="倒入Maven项目到idea后可以看到生成的项目工程">  </p>
<h2 id="idea构建"><a href="#idea构建" class="headerlink" title="idea构建"></a>idea构建</h2><p>idea中可以直接通过Spring Initializer插件来构建项目工程（原理还是基于网页<a href="http://start.spring.io）" target="_blank" rel="noopener">http://start.spring.io）</a></p>
<p><img src="/2019/06/17/springboot-4/startbyidea.png" alt="通过idea来构建项目工程">  </p>
<h2 id="手工maven构建"><a href="#手工maven构建" class="headerlink" title="手工maven构建"></a>手工maven构建</h2><p>手工构建之需要在pom文件中增加如下代码即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">   &lt;parent&gt;</span><br><span class="line">	&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</span><br><span class="line">	&lt;version&gt;2.1.5.RELEASE&lt;/version&gt;</span><br><span class="line">	&lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;</span><br><span class="line">&lt;/parent&gt;</span><br></pre></td></tr></table></figure>
<p>spring-boot-starter-parent是一个特殊的starter。提供一些maven默认的依赖。使用该starter以后，常用的依赖可以省去version标签。<br><strong>具体提供的默认依赖可以通过 ${loccal_repositry}/org/springframework/boot/spring-boot-dependencies/1.3.0.M1/spring-boot-dependencies-1.3.0M1.pom中查看</strong>  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">     &lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>增加spring-boot-starter-web依赖</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">    &lt;plugins&gt;</span><br><span class="line">	&lt;plugin&gt;</span><br><span class="line">		&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">		&lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">	&lt;/plugin&gt;</span><br><span class="line">&lt;/plugins&gt;</span><br></pre></td></tr></table></figure>
<p>增加spring-boot-maven-plugin插件即可。</p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><blockquote>
<p>《SpringBoot实战》 汪云飞著 </p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/06/16/idea-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小磊砸">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小磊砸的布劳格">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/06/16/idea-1/" itemprop="url">idea 使用问题汇总</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-06-16T19:53:00+08:00">
                2019-06-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/idea/" itemprop="url" rel="index">
                    <span itemprop="name">idea</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/06/16/idea-1/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/06/16/idea-1/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Idea设置"><a href="#Idea设置" class="headerlink" title="Idea设置"></a>Idea设置</h1><h2 id="代码自动换行"><a href="#代码自动换行" class="headerlink" title="代码自动换行"></a>代码自动换行</h2><p><img src="/2019/06/16/idea-1/自动换行.png" alt="自动换行">  </p>
<h1 id="Tomcat"><a href="#Tomcat" class="headerlink" title="Tomcat"></a>Tomcat</h1><h2 id="not-found-for-the-web-module"><a href="#not-found-for-the-web-module" class="headerlink" title="not found for the web module"></a>not found for the web module</h2><p><img src="/2019/06/16/idea-1/notfoundwebmodul.png" alt="找不到web模块">  </p>
<p>如图项目需要配置Artifacts，并且需要将项目依赖的东西红框区域都添加到左边。  这里Artifacts主要的作用是配置项目打包的相关配置信息。<br>如果是有web.xml的需要在Facets中配置好web.xml的路径。之后再在tomcat中部署项目。</p>
<p><img src="/2019/06/16/idea-1/tomcatdeployment.png" alt="tomcat部署">  </p>
<h1 id="maven"><a href="#maven" class="headerlink" title="maven"></a>maven</h1><h2 id="解决Jar包冲突"><a href="#解决Jar包冲突" class="headerlink" title="解决Jar包冲突"></a>解决Jar包冲突</h2><p><img src="/2019/06/16/idea-1/jar包冲突.png" alt="jar包冲突">  </p>
<p>在maven视图中，选中dependencies后点击按钮show dependecies后可以看到整个依赖的视图。<br>这里面红线标记的就是有冲突的，虚红线表示有多次引用。</p>
<p><img src="/2019/06/16/idea-1/dependencies.png" alt="依赖分析">  </p>
<p>从底层开始，依次选中有红线的jar包后右键exclude来排除此jar包，每次排除操作需要稍微等一下视图更新后再次操作。</p>
<p><img src="/2019/06/16/idea-1/exclude.png" alt="exclude操作">  </p>
<p><img src="/2019/06/16/idea-1/解决完毕.png" alt="解决完毕">  </p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><blockquote>
<p><a href="https://blog.csdn.net/linjpg/article/details/78600107" target="_blank" rel="noopener">idea部署maven项目到tomcat</a><br><a href="https://blog.csdn.net/qq_35246620/article/details/79753210" target="_blank" rel="noopener">idea解决jar包冲突</a>  </p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/06/15/redis-5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小磊砸">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小磊砸的布劳格">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/06/15/redis-5/" itemprop="url">redis 部署方式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-06-15T14:59:41+08:00">
                2019-06-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/redis/" itemprop="url" rel="index">
                    <span itemprop="name">redis</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/06/15/redis-5/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/06/15/redis-5/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="单机-standaloan"><a href="#单机-standaloan" class="headerlink" title="单机(standaloan)"></a>单机(standaloan)</h1><p>只有一个redis节点，生产环境不推荐，一旦redis节点宕机导致整个服务不可用。</p>
<h2 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h2><ul>
<li>容量有限</li>
<li>处理能力有限</li>
<li>无法高可用</li>
</ul>
<h1 id="主从-master-slave"><a href="#主从-master-slave" class="headerlink" title="主从(master/slave)"></a>主从(master/slave)</h1><p><img src="/2019/06/15/redis-5/主从模式.png" alt="哨兵模式">  </p>
<p>基于redis本身的复制(replication)功能。选择一个redis节点作为master，其余的节点作为slave节点来复制master的数据。master负责读/写操作，slave节点负责读操作。如果网络通畅，master节点会将数据变化同步给slave节点，保证数据的一致性。</p>
<h2 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h2><h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ul>
<li>master/slave节点数据一致</li>
<li>降低了master节点的读压力。</li>
</ul>
<h3 id="缺点-1"><a href="#缺点-1" class="headerlink" title="缺点"></a>缺点</h3><ul>
<li>无法高可用（一旦master宕机，服务不可用，需要人工干预重新指定master节点）</li>
<li>没有降低master的写压力</li>
</ul>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>本机是通过brew来安装的redis。所以配置默认是在 /usr/local/etc/redis.conf。为了便于后续的管理，我在/usr/local/etc/下专门创建了redis配置的目录。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 创建目录</span><br><span class="line">mkdir /usr/local/etc/redis</span><br><span class="line"># 复制配置文件</span><br><span class="line">cp /usr/local/etc/redis.conf /usr/local/etc/redis/6380.conf</span><br></pre></td></tr></table></figure>
<p>主节点的配置是6380.conf<br>配置文件中细节很多，但主要关注的是如下配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 不绑定ip 任何ip都可以访问</span><br><span class="line">bind 0.0.0.0 </span><br><span class="line"># 关闭保护，允许非本地连接</span><br><span class="line">protected-mode no</span><br><span class="line"># 端口</span><br><span class="line">port 6380</span><br><span class="line"># 后台运行</span><br><span class="line">daemonize yes</span><br><span class="line"># pid的存储路径</span><br><span class="line">pidfile /var/run/redis/6380.pid</span><br><span class="line"># 数据存储的目录</span><br><span class="line">dir /usr/local/redis/6388/</span><br><span class="line">#采用AOF的方式来持久化数据</span><br><span class="line">appendonly yes</span><br></pre></td></tr></table></figure>
<p>再基于6380.conf复制出6381.conf和6382.conf两个配置文件，这两个作为slave节点的配置，只需要将相应的端口信息改成自己的端口同时还要追加一个主节点的配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># master 节点信息</span><br><span class="line">slaveof 127.0.0.1 6380</span><br></pre></td></tr></table></figure>
<h3 id="启停脚本"><a href="#启停脚本" class="headerlink" title="启停脚本"></a>启停脚本</h3><p>在用户目录的bin目录下创建了startredis-ms.sh脚本。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">BASE_PATH=$BREW_HOME</span><br><span class="line">APP_NAME=redis</span><br><span class="line">VERSION=5.0.5</span><br><span class="line">BIN_PATH=$BASE_PATH/$APP_NAME/$VERSION/bin</span><br><span class="line">CONF_PATH=$BREW_HOME/../etc/redis</span><br><span class="line"></span><br><span class="line">echo start master</span><br><span class="line">$BIN_PATH/redis-server $CONF_PATH/6380.conf</span><br><span class="line"></span><br><span class="line">echo start slave</span><br><span class="line">$BIN_PATH/redis-server $CONF_PATH/6381.conf</span><br><span class="line">$BIN_PATH/redis-server $CONF_PATH/6382.conf</span><br></pre></td></tr></table></figure>
<p>创建根据指定端口号来启动redis的脚本startredis.sh</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">BASE_PATH=$BREW_HOME</span><br><span class="line">APP_NAME=redis</span><br><span class="line">VERSION=5.0.5</span><br><span class="line">BIN_PATH=$BASE_PATH/$APP_NAME/$VERSION/bin</span><br><span class="line">CONF_PATH=$BREW_HOME/../etc/redis</span><br><span class="line"></span><br><span class="line">if [ $# -eq 0 ];then</span><br><span class="line">  echo &quot;You&apos;d better input redis server port!&quot;</span><br><span class="line">  exit -1</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">for port in &quot;$@&quot; ;do</span><br><span class="line">  echo &quot;start redis server port :$&#123;port&#125; ...&quot;</span><br><span class="line">  $BIN_PATH/redis-server $CONF_PATH/$&#123;port&#125;.conf</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<p>创建根据指定端口号来停止redis的脚本stopredis.sh</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">BASE_PATH=$BREW_HOME</span><br><span class="line">APP_NAME=redis</span><br><span class="line">VERSION=5.0.5</span><br><span class="line">BIN_PATH=$BASE_PATH/$APP_NAME/$VERSION/bin</span><br><span class="line">CONF_PATH=$BREW_HOME/../etc/redis</span><br><span class="line"></span><br><span class="line">if [ $# -eq 0 ];then</span><br><span class="line">  echo &quot;You&apos;d better input redis server port!&quot;</span><br><span class="line">  exit -1</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">for port in &quot;$@&quot; ;do</span><br><span class="line">  echo &quot;stop redis server port :$&#123;port&#125; !&quot;</span><br><span class="line">  $BIN_PATH/redis-cli -p $&#123;port&#125; shutdown</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<h3 id="查看验证"><a href="#查看验证" class="headerlink" title="查看验证"></a>查看验证</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 查看redis的进程 </span><br><span class="line">ps -ef|grep redis</span><br><span class="line"># 连接到master节点</span><br><span class="line">redis-cli -p 6380</span><br><span class="line"># info</span><br><span class="line">查看节点信息</span><br></pre></td></tr></table></figure>
<p><img src="/2019/06/15/redis-5/info.png" alt="查看节点信息">  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 连接slave节点</span><br><span class="line">redis-cli -p 6381</span><br><span class="line"># 创建key:a valye:1 </span><br><span class="line">set a 1</span><br><span class="line">(error) READONLY You can&apos;t write against a read only replica.</span><br></pre></td></tr></table></figure>
<p><strong>从上面的操作记录可以看到，slave节点不能完成写操作，只能进行读操作。</strong></p>
<h1 id="哨兵-sentinel"><a href="#哨兵-sentinel" class="headerlink" title="哨兵(sentinel)"></a>哨兵(sentinel)</h1><p><img src="/2019/06/15/redis-5/哨兵模式.png" alt="哨兵模式">  </p>
<p>哨兵模式是基于主从复制的基础上，增加了哨兵监控进程，用于当master节点宕机后自动进行主从切换来保证redis服务的高可用。</p>
<h2 id="特征"><a href="#特征" class="headerlink" title="特征"></a>特征</h2><ul>
<li>监控：sentinel会不断的检查master节点与slave节点的状态是否正常。</li>
<li>提醒：当监控到某个节点异常后，sentinel会通过API的方式通知管理人员，或向应用程序发送通知。</li>
<li>自动故障迁移：当master节点故障后，sentinel会自动将slave选举成新的master并通知其余的slave。</li>
</ul>
<h2 id="哨兵定时任务"><a href="#哨兵定时任务" class="headerlink" title="哨兵定时任务"></a>哨兵定时任务</h2><ul>
<li>info命令，哨兵会每隔10秒向master和slave节点发送info命令，用于获取最新的拓扑图。sentinel的配置只有master节点的信息，slave的信息从master中获取。</li>
<li>广播消息：哨兵会向所有的redis节点发送当前哨兵节点信息和对于master节点的认知信息，同时所有的哨兵也会订阅该消息，来了解其他的哨兵节点以及其他哨兵节点认知的master节点信息。</li>
<li>心跳检测：哨兵会ping master/slave节点进行心跳检测。</li>
</ul>
<h2 id="主观下线和客观下线"><a href="#主观下线和客观下线" class="headerlink" title="主观下线和客观下线"></a>主观下线和客观下线</h2><p>当哨兵认为master节点下线，这是主观下线，哨兵会发送is-master-down-by-addr的命令，寻求其他对master节点的状态判断，如果有过半数的哨兵认同master节点下线，就是客观下线。</p>
<h2 id="哨兵leader选举，故障迁移"><a href="#哨兵leader选举，故障迁移" class="headerlink" title="哨兵leader选举，故障迁移"></a>哨兵leader选举，故障迁移</h2><p>当哨兵发现master下线后，发送is-master-down-by-addr命令，寻求其他哨兵对master节点状态的判断，并征求自己是否可以成为leader，其他哨兵可以同意或拒绝，当有过半数的哨兵同意某一个哨兵的竞选消息后，该哨兵成为leader。leader能够决定后续的故障迁移工作选举新的master节点。</p>
<p><img src="/2019/06/15/redis-5/故障迁移.png" alt="故障迁移">  </p>
<h2 id="故障迁移的步骤"><a href="#故障迁移的步骤" class="headerlink" title="故障迁移的步骤"></a>故障迁移的步骤</h2><ol>
<li>多个哨兵认同master节点下线（客观下线）</li>
<li>选举一个哨兵作为leader</li>
<li>leader哨兵决定新的master节点</li>
<li>通知其余的slave新的master节点</li>
<li>通知应用新的master节点</li>
<li>老的master重新上线后成为新的slave。</li>
</ol>
<h2 id="配置-1"><a href="#配置-1" class="headerlink" title="配置"></a>配置</h2><p>在/usr/local/etc/redis目录下增加了哨兵的目录sentinel。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 创建目录</span><br><span class="line">mkdir /usr/local/etc/redis/sentinel</span><br><span class="line"># 将默认的哨兵配置复制到配置目录中</span><br><span class="line">cp /usr/local/etc/redis-sentinel.conf /usr/local/etc/redis/sentinel/26380.conf</span><br></pre></td></tr></table></figure>
<p>哨兵也需要集群配置，默认提供一个节点的配置，其余参考的修改</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># 不绑定ip 任何ip都可以访问</span><br><span class="line">bind 0.0.0.0 </span><br><span class="line"># 关闭保护，允许非本地连接</span><br><span class="line">protected-mode no</span><br><span class="line"># 端口</span><br><span class="line">port 26380</span><br><span class="line"># 后台运行</span><br><span class="line">daemonize yes</span><br><span class="line"># pid的存储路径</span><br><span class="line">pidfile /var/run/redis/26380.pid</span><br><span class="line"># 不存储数据</span><br><span class="line">dir /private/tmp</span><br><span class="line">#设置 主名称 ip地址 端口号 选举厕次数</span><br><span class="line">sentinel monitor mymaster 127.0.0.1 6380 1</span><br><span class="line">#sentinel心跳检测主3秒内无响应，视为挂掉，开始切换其他从为主</span><br><span class="line">sentinel down-after-milliseconds mymaster 3000</span><br><span class="line">#每次最多可以有1个从同步主。一个从同步结束，另一个从开始同步。</span><br><span class="line">sentinel parallel-syncs mymaster 1</span><br><span class="line">#主从切换超时时间</span><br><span class="line">sentinel failover-timeout mymaster 18000</span><br></pre></td></tr></table></figure>
<h2 id="启停脚本-1"><a href="#启停脚本-1" class="headerlink" title="启停脚本"></a>启停脚本</h2><p>哨兵的启动有两种方式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">redis-server *.conf --sentinel</span><br><span class="line">redis-sentinel * .conf (推荐)</span><br></pre></td></tr></table></figure>
<p>启动脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">BASE_PATH=$BREW_HOME</span><br><span class="line">APP_NAME=redis</span><br><span class="line">VERSION=5.0.5</span><br><span class="line">BIN_PATH=$BASE_PATH/$APP_NAME/$VERSION/bin</span><br><span class="line">CONF_PATH=$BREW_HOME/../etc/redis/sentinel</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">echo start sentinel...</span><br><span class="line">$BIN_PATH/redis-sentinel $CONF_PATH/26380.conf</span><br><span class="line">$BIN_PATH/redis-sentinel $CONF_PATH/26381.conf</span><br><span class="line">$BIN_PATH/redis-sentinel $CONF_PATH/26382.conf</span><br></pre></td></tr></table></figure>
<p>停止还是stopredis.sh，通过redis-cli 连接后执行shutdown命令</p>
<h2 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 查看进程</span><br><span class="line">ps -ef|grep redis</span><br><span class="line"># 连接哨兵</span><br><span class="line">redis-cli -p 26380 </span><br><span class="line"># 查看节点详情</span><br><span class="line">info</span><br></pre></td></tr></table></figure>
<p><img src="/2019/06/15/redis-5/哨兵info.png" alt="哨兵info">  </p>
<h1 id="集群-redis-cluster"><a href="#集群-redis-cluster" class="headerlink" title="集群(redis-cluster)"></a>集群(redis-cluster)</h1><h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><blockquote>
<p><a href="https://blog.csdn.net/ahfywangqiang/article/details/86537421" target="_blank" rel="noopener">部署方式</a><br><a href="https://www.jianshu.com/p/1a9738ddeed6" target="_blank" rel="noopener">部署方式选型</a><br><a href="https://www.cnblogs.com/zwcry/p/9046207.html" target="_blank" rel="noopener">主从模式搭建教程</a><br><a href="https://www.cnblogs.com/zwcry/p/9134721.html" target="_blank" rel="noopener">哨兵模式搭建教程</a><br><a href="https://www.cnblogs.com/leeSmall/p/8398401.html" target="_blank" rel="noopener">哨兵机制讲解</a>  </p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/06/12/logback/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小磊砸">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小磊砸的布劳格">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/06/12/logback/" itemprop="url">日志系统</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-06-12T20:54:30+08:00">
                2019-06-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/日志系统/" itemprop="url" rel="index">
                    <span itemprop="name">日志系统</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/06/12/logback/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/06/12/logback/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Log4J"><a href="#Log4J" class="headerlink" title="Log4J"></a>Log4J</h1><ul>
<li>Log4J(Log for Java)  </li>
<li>支持properties和xml两种方式配置</li>
</ul>
<h2 id="日志级别"><a href="#日志级别" class="headerlink" title="日志级别"></a>日志级别</h2><p><strong>TRACE&lt;DEBUG&lt;INFO&lt;WARN&lt;ERROR&lt;FATAL&lt;OFF</strong> </p>
<h2 id="配置样例"><a href="#配置样例" class="headerlink" title="配置样例"></a>配置样例</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE log4j:configuration PUBLIC &quot;-//LOGGER&quot; &quot;http://logging.apache.org/log4j/1.2/apidocs/org/apache/log4j/xml/doc-files/log4j.dtd&quot;&gt;</span><br><span class="line">&lt;log4j:configuration&gt;    </span><br><span class="line">　　&lt;!--an appender is an output destination, such as the console or a file; names of appenders are arbitrarily chosen--&gt;    </span><br><span class="line">　　&lt;appender name=&quot;stdout&quot; class=&quot;org.apache.log4j.ConsoleAppender&quot;&gt;</span><br><span class="line">　　　　&lt;layout class=&quot;org.apache.log4j.PatternLayout&quot;&gt;</span><br><span class="line">　　　　　　&lt;param name=&quot;ConversionPattern&quot; value=&quot;%d&#123;ABSOLUTE&#125; %5p %c&#123;1&#125;:%L - %m%n&quot; /&gt;</span><br><span class="line">　　　　&lt;/layout&gt;</span><br><span class="line">　　&lt;/appender&gt;</span><br><span class="line"></span><br><span class="line">　　&lt;!--loggers of category &apos;org.springframework&apos; will only log messages of level &quot;info&quot; or higher; if you retrieve Loggers by using the class name (e.g. Logger.getLogger(AClass.class)) and if AClass is part of the org.springframework package, it will belong to this category--&gt;    </span><br><span class="line">　　&lt;logger name=&quot;org.springframework&quot;&gt;        </span><br><span class="line">　　　　&lt;level value=&quot;info&quot;/&gt;    </span><br><span class="line">　　&lt;/logger&gt;    </span><br><span class="line"></span><br><span class="line">　　&lt;!--everything of spring was set to &quot;info&quot; but for class PropertyEditorRegistrySupport we want &quot;debug&quot; logging--&gt;    </span><br><span class="line">　　&lt;logger name=&quot;org.springframework.beans.PropertyEditorRegistrySupport&quot;&gt;        </span><br><span class="line">　　　　&lt;level value=&quot;debug&quot;/&gt;    </span><br><span class="line">　　&lt;/logger&gt;     </span><br><span class="line">　　</span><br><span class="line">　　&lt;root&gt;    </span><br><span class="line">　　&lt;!--all log messages of level &quot;debug&quot; or higher will be logged, unless defined otherwise all log messages will be logged to the appender &quot;stdout&quot;, unless defined otherwise--&gt;        </span><br><span class="line">　　　　&lt;level value=&quot;debug&quot; /&gt;        </span><br><span class="line">　　　　&lt;appender-ref ref=&quot;stdout&quot; /&gt;    </span><br><span class="line">　　&lt;/root&gt;</span><br><span class="line"></span><br><span class="line">&lt;/log4j:configuration&gt;</span><br></pre></td></tr></table></figure>
<h1 id="SLF4J"><a href="#SLF4J" class="headerlink" title="SLF4J"></a>SLF4J</h1><p>SLF4J(Simple Logging Fcade Java)简单的日志门面。<br>SLF4J是提供了一系列的日志接口，但不提供实现，不同的日志框架来提供具体的实现，这样允许用户在最终部署系统时可以随意切换自己的日志框架。<br>实际SLF4J提供核心的日志API以及LoggerFactory。在使用日志的时候，不需要代码或者配置文件显示的指定日志框架，之需要通过SLF4J的api来进行日志记录，最终日志的格式，级别，输出方式等都是由具体的日志框架的配置来决定。因此可以灵活的切换日志框架而代码无感。</p>
<h1 id="Logback"><a href="#Logback" class="headerlink" title="Logback"></a>Logback</h1><p>一个可靠、通用、快速而灵活的日志系统。<strong>性能优于log4j（大约快10倍，并更少的内存消耗）</strong><br>由logback-core、logback-classic:log4j、和logback-access三个模块组成。</p>
<ul>
<li>logback-core:核心代码模块</li>
<li>logback-classis:log4j:log4j改良版，同时实现了self4j的接口。支持通过sefl4j的api来使用日志系统。</li>
<li>logback-access:访问模块并与Servlet容器集成提供通过http来访问日志的功能。</li>
</ul>
<h2 id="配置文件的加载顺序"><a href="#配置文件的加载顺序" class="headerlink" title="配置文件的加载顺序"></a>配置文件的加载顺序</h2><ol>
<li>java启动参数logback.configurationFile 指定的配置文件(如java -Dlogback.configurationFile=/path/to/mylogback.xml Test) </li>
<li>在classpath下查找logback.groovy文件</li>
<li>在calsspath下查找logback-test.xml文件</li>
<li>在classpath下查找logback.xml文件</li>
<li>如果是JDK6+，会调用ServiceLoader查找com.qos.logback.classic.spi.Configurator接口的第一个实现类</li>
<li>默认使用ch.qos.logback.classic.BasicConfigurator在控制台输出日志</li>
</ol>
<p>logback会按照上面的顺序依次查找配置文件，找到了就不会再往下走（ContextInitializer#autoConfig()）。</p>
<h2 id="日志级别-1"><a href="#日志级别-1" class="headerlink" title="日志级别"></a>日志级别</h2><p><strong>trace&lt;debug&lt;info&lt;warn&lt;error</strong></p>
<h2 id="配置样例-1"><a href="#配置样例-1" class="headerlink" title="配置样例"></a>配置样例</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;configuration debug=&quot;true&quot; scan=&quot;true&quot; scanPeriod=&quot;1 seconds&quot;&gt;</span><br><span class="line">	&lt;!-- 定义日志上下文的名称，可以通过%contextName%来使用 --&gt;</span><br><span class="line">    &lt;contextName&gt;logback&lt;/contextName&gt;</span><br><span class="line">    &lt;!--定义参数,后面可以通过$&#123;app.name&#125;使用--&gt;</span><br><span class="line">    &lt;property name=&quot;app.name&quot; value=&quot;logback_test&quot;/&gt;</span><br><span class="line">    &lt;!--ConsoleAppender 用于在屏幕上输出日志--&gt;</span><br><span class="line">    &lt;appender name=&quot;stdout&quot; class=&quot;ch.qos.logback.core.ConsoleAppender&quot;&gt;</span><br><span class="line">        &lt;!--定义了一个过滤器,在LEVEL之下的日志输出不会被打印出来--&gt;</span><br><span class="line">        &lt;!--这里定义了DEBUG，也就是控制台不会输出比DEBUG级别小的日志--&gt;</span><br><span class="line">        &lt;filter class=&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;&gt;</span><br><span class="line">            &lt;level&gt;DEBUG&lt;/level&gt;</span><br><span class="line">        &lt;/filter&gt;</span><br><span class="line">        &lt;!-- encoder 默认配置为PatternLayoutEncoder --&gt;</span><br><span class="line">        &lt;!--定义控制台输出格式--&gt;</span><br><span class="line">        &lt;encoder&gt;</span><br><span class="line">            &lt;pattern&gt;%d [%thread] %-5level %logger&#123;36&#125; [%file : %line] - %msg%n&lt;/pattern&gt;</span><br><span class="line">        &lt;/encoder&gt;</span><br><span class="line">    &lt;/appender&gt;</span><br><span class="line"></span><br><span class="line">    &lt;appender name=&quot;file&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt;</span><br><span class="line">        &lt;!--定义日志输出的路径--&gt;</span><br><span class="line">        &lt;!--这里的scheduler.manager.server.home 没有在上面的配置中设定，所以会使用java启动时配置的值--&gt;</span><br><span class="line">        &lt;!--比如通过 java -Dscheduler.manager.server.home=/path/to XXXX 配置该属性--&gt;</span><br><span class="line">        &lt;file&gt;$&#123;scheduler.manager.server.home&#125;/logs/$&#123;app.name&#125;.log&lt;/file&gt;</span><br><span class="line">        &lt;!--定义日志滚动的策略--&gt;</span><br><span class="line">        &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt;</span><br><span class="line">            &lt;!--定义文件滚动时的文件名的格式--&gt;</span><br><span class="line">            &lt;fileNamePattern&gt;$&#123;scheduler.manager.server.home&#125;/logs/$&#123;app.name&#125;.%d&#123;yyyy-MM-dd.HH&#125;.log.gz</span><br><span class="line">            &lt;/fileNamePattern&gt;</span><br><span class="line">            &lt;!--60天的时间周期，日志量最大20GB--&gt;</span><br><span class="line">            &lt;maxHistory&gt;60&lt;/maxHistory&gt;</span><br><span class="line">            &lt;!-- 该属性在 1.1.6版本后 才开始支持--&gt;</span><br><span class="line">            &lt;totalSizeCap&gt;20GB&lt;/totalSizeCap&gt;</span><br><span class="line">        &lt;/rollingPolicy&gt;</span><br><span class="line">        &lt;triggeringPolicy class=&quot;ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy&quot;&gt;</span><br><span class="line">            &lt;!--每个日志文件最大100MB--&gt;</span><br><span class="line">            &lt;maxFileSize&gt;100MB&lt;/maxFileSize&gt;</span><br><span class="line">        &lt;/triggeringPolicy&gt;</span><br><span class="line">        &lt;!--定义输出格式--&gt;</span><br><span class="line">        &lt;encoder&gt;</span><br><span class="line">            &lt;pattern&gt;%d [%thread] %-5level %logger&#123;36&#125; [%file : %line] - %msg%n&lt;/pattern&gt;</span><br><span class="line">        &lt;/encoder&gt;</span><br><span class="line">    &lt;/appender&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--root是默认的logger 这里设定输出级别是debug--&gt;</span><br><span class="line">    &lt;root level=&quot;trace&quot;&gt;</span><br><span class="line">        &lt;!--定义了两个appender，日志会通过往这两个appender里面写--&gt;</span><br><span class="line">        &lt;appender-ref ref=&quot;stdout&quot;/&gt;</span><br><span class="line">        &lt;appender-ref ref=&quot;file&quot;/&gt;</span><br><span class="line">    &lt;/root&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--对于类路径以 com.example.logback 开头的Logger,输出级别设置为warn,并且只输出到控制台--&gt;</span><br><span class="line">    &lt;!--这个logger没有指定appender，它会继承root节点中定义的那些appender--&gt;</span><br><span class="line">    &lt;logger name=&quot;com.example.logback&quot; level=&quot;warn&quot;/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--通过 LoggerFactory.getLogger(&quot;mytest&quot;) 可以获取到这个logger--&gt;</span><br><span class="line">    &lt;!--由于这个logger自动继承了root的appender，root中已经有stdout的appender了，自己这边又引入了stdout的appender--&gt;</span><br><span class="line">    &lt;!--如果没有设置 additivity=&quot;false&quot; ,就会导致一条日志在控制台输出两次的情况--&gt;</span><br><span class="line">    &lt;!--additivity表示要不要使用rootLogger配置的appender进行输出--&gt;</span><br><span class="line">    &lt;logger name=&quot;mytest&quot; level=&quot;info&quot; additivity=&quot;false&quot;&gt;</span><br><span class="line">        &lt;appender-ref ref=&quot;stdout&quot;/&gt;</span><br><span class="line">    &lt;/logger&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!--由于设置了 additivity=&quot;false&quot; ，所以输出时不会使用rootLogger的appender--&gt;</span><br><span class="line">    &lt;!--但是这个logger本身又没有配置appender，所以使用这个logger输出日志的话就不会输出到任何地方--&gt;</span><br><span class="line">    &lt;logger name=&quot;mytest2&quot; level=&quot;info&quot; additivity=&quot;false&quot;/&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>
<h3 id="configuration"><a href="#configuration" class="headerlink" title="configuration"></a>configuration</h3><table>
<thead>
<tr>
<th>属性</th>
<th>默认值</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>debug</td>
<td>false</td>
<td>是否打印logback本身内部的日志</td>
</tr>
<tr>
<td>scan</td>
<td>true</td>
<td>配置变化，是否重新加载</td>
</tr>
<tr>
<td>scanPeriod</td>
<td>1 seconds</td>
<td>检查配置变化的时间间隔,默认单位是毫秒</td>
</tr>
</tbody>
</table>
<h3 id="contextName"><a href="#contextName" class="headerlink" title="contextName"></a>contextName</h3><p>定义日志上下文的名称，通过%contextName%来作为变量使用</p>
<h3 id="property"><a href="#property" class="headerlink" title="property"></a>property</h3><p>定义上下文中可用的属性，通过key,value来定义，通过${key}来使用</p>
<h3 id="appender"><a href="#appender" class="headerlink" title="appender"></a>appender</h3><p>定义日志输出组件。常用的属性是name和class</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>默认值</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>无</td>
<td>日志输出组件的名称</td>
</tr>
<tr>
<td>class</td>
<td>无</td>
<td>日志输出组件的具体实现类，常用的有ConsoleAppender、FileAppender、RollingFileAppender</td>
</tr>
</tbody>
</table>
<ul>
<li>ConsoleAppender:控制台输出组件实现类</li>
<li>FileAppender:文件输出组件实现类</li>
<li>RollingFileAppender:结合滚动策略滚动生成日志文件的实现类</li>
</ul>
<p>appender可以配置filter，样例配置中配置了一个ch.qos.logback.classic.filter.ThresholdFilter来过滤日志。<br>RollingFileAppender可以配置滚动策略（rollingPolicy），</p>
<h3 id="root"><a href="#root" class="headerlink" title="root"></a>root</h3><p>定义默认的日志记录器，即针对LoggerFactory.getLogger(XXX)获取的所有Logger如果没有特殊的logger匹配，则默认就是root定义的logger。常用的属性有level</p>
<ul>
<li>level 定义默认的日志记录器的日志级别</li>
</ul>
<p>root下面可以通过appender-ref指定默认日志记录器对应的日志输出组件。样例中默认日志记录器采用控制台和滚动文件两种日志输出组件。</p>
<h3 id="logger"><a href="#logger" class="headerlink" title="logger"></a>logger</h3><p>定义日志记录器,常用的属性有name，level和additivity。</p>
<ul>
<li>name 日志记录器的名称，即LoggerFactory.getLogger(name)来获取logger。通过name来匹配。同时LoggerFactory.getLogger(XXX.class)会自动转换成字符串packagepath+’.’+className+’.’+class。当然这里的name可以配置部分包路径，这样包下的所有都会匹配该logger。</li>
<li>level 日志记录器的日志级别</li>
<li>additivity 是否采用root下使用的日志输出组件(appender-ref)，日志最大容量(totalSizeCap)和日志文件最大含量(maxFileSize)，<strong>maxFileSize和totalSizeCap属性在1.1.6版本后才支持。</strong></li>
</ul>
<h2 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a>实现原理</h2><p>可以看<a href="https://www.jianshu.com/p/04065d8cb2a9" target="_blank" rel="noopener">简书</a></p>
<h2 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h2><ul>
<li>性能较log4j 快10倍，并且更少的内存消耗。</li>
<li>logback实现了self4j接口，可以为以后日志系统的切换提供便捷</li>
<li>logback除了支持xml配置还支持groovy格式的配置（更加直观简洁）</li>
<li>logback能够检测到配置文件的修改并实时加载更新配置（热部署）</li>
<li>logback能自动从I/O异常中恢复，无需重启服务</li>
<li>logback可以配置上限值，自动删除旧的日志</li>
<li>logback能够自动压缩日志</li>
<li>logback配置中支持if，then,else的条件语句，这样在dev，product等不同的环境下避免日志配置的重复</li>
<li>logback的stack trace包含更多的信息</li>
<li>logback提供更多的filter</li>
<li>logback能够结合Servlet容器提供http-access日志</li>
</ul>
<h1 id="Log4j2"><a href="#Log4j2" class="headerlink" title="Log4j2"></a>Log4j2</h1><ul>
<li>log4j 改良版</li>
<li>插件式结构，支持自行拓展自己的appender,logger,filter。</li>
<li>支持json配置文件</li>
<li>配置文件中可以直接引用属性，还可以直接替代或传值到组件</li>
</ul>
<h2 id="配置样例-2"><a href="#配置样例-2" class="headerlink" title="配置样例"></a>配置样例</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE xml&gt;</span><br><span class="line">&lt;!-- Log4j 2.x 配置文件。每30秒自动检查和应用配置文件的更新； --&gt;</span><br><span class="line">&lt;Configuration status=&quot;warn&quot; monitorInterval=&quot;30&quot; strict=&quot;true&quot; schema=&quot;Log4J-V2.2.xsd&quot;&gt;</span><br><span class="line">    &lt;Appenders&gt;</span><br><span class="line">           &lt;!-- 输出到控制台 --&gt;</span><br><span class="line">           &lt;Console name=&quot;Console&quot; target=&quot;SYSTEM_OUT&quot;&gt;</span><br><span class="line">               &lt;!-- 需要记录的级别 --&gt;</span><br><span class="line">               &lt;!-- &lt;ThresholdFilter level=&quot;debug&quot; onMatch=&quot;ACCEPT&quot; onMismatch=&quot;DENY&quot; /&gt; --&gt;</span><br><span class="line">               &lt;PatternLayout pattern=&quot;%d&#123;yyyy-MM-dd HH:mm:ss,SSS&#125;:%4p %t (%F:%L) - %m%n&quot; /&gt;</span><br><span class="line">          &lt;/Console&gt;</span><br><span class="line"></span><br><span class="line">          &lt;!-- 输出到文件，按天或者超过80MB分割 --&gt;</span><br><span class="line">          &lt;RollingFile name=&quot;RollingFile&quot; fileName=&quot;../logs/xjj.log&quot;    filePattern=&quot;../logs/$$&#123;date:yyyy-MM&#125;/xjj-%d&#123;yyyy-MM-dd&#125;-%i.log.gz&quot;&gt;</span><br><span class="line">               &lt;!-- 需要记录的级别 --&gt;</span><br><span class="line">               &lt;!-- &lt;ThresholdFilter level=&quot;info&quot; onMatch=&quot;ACCEPT&quot; onMismatch=&quot;DENY&quot; /&gt; --&gt;</span><br><span class="line">               &lt;PatternLayout pattern=&quot;%d&#123;yyyy-MM-dd HH:mm:ss,SSS&#125;:%4p %t (%F:%L) - %m%n&quot; /&gt;</span><br><span class="line">               &lt;Policies&gt;</span><br><span class="line">                    &lt;OnStartupTriggeringPolicy /&gt;</span><br><span class="line">                    &lt;TimeBasedTriggeringPolicy /&gt;</span><br><span class="line">                    &lt;SizeBasedTriggeringPolicy size=&quot;80 MB&quot; /&gt;</span><br><span class="line">               &lt;/Policies&gt;</span><br><span class="line">          &lt;/RollingFile&gt;</span><br><span class="line">     &lt;/Appenders&gt;</span><br><span class="line">     &lt;Loggers&gt;</span><br><span class="line">          &lt;Root level=&quot;info&quot;&gt; &lt;!-- 全局配置 --&gt;</span><br><span class="line">               &lt;AppenderRef ref=&quot;Console&quot; /&gt;</span><br><span class="line">               &lt;AppenderRef ref=&quot;RollingFile&quot;/&gt;</span><br><span class="line">          &lt;/Root&gt;</span><br><span class="line">          &lt;!-- 为sql语句配置特殊的Log级别，方便调试 --&gt;</span><br><span class="line">          &lt;Logger name=&quot;com.xjj.dao&quot; level=&quot;$&#123;log.sql.level&#125;&quot; additivity=&quot;false&quot;&gt;</span><br><span class="line">               &lt;AppenderRef ref=&quot;Console&quot; /&gt;</span><br><span class="line">          &lt;/Logger&gt;</span><br><span class="line">     &lt;/Loggers&gt;</span><br><span class="line">&lt;/Configuration&gt;</span><br></pre></td></tr></table></figure>
<h1 id="JUL"><a href="#JUL" class="headerlink" title="JUL"></a>JUL</h1><ul>
<li>JUL(java.util.logging)</li>
<li>Java自身的日志系统，类似log4j。但是对开发者很不友好，还有bug。</li>
</ul>
<h1 id="JCL"><a href="#JCL" class="headerlink" title="JCL"></a>JCL</h1><p>与self4j类似，也是提供一套日志API，但其查找logger的算法复杂，出现classloader异常时无法修复。</p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><blockquote>
<p><a href="https://www.jianshu.com/p/04065d8cb2a9" target="_blank" rel="noopener">简书：logback详解</a><br><a href="https://www.cnblogs.com/junzi2099/p/7930268.html" target="_blank" rel="noopener">各种日志框架的差异</a><br><a href="https://www.jianshu.com/p/04065d8cb2a9" target="_blank" rel="noopener">logback日志配置文件详解</a>    </p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/06/11/maven-01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小磊砸">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小磊砸的布劳格">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/06/11/maven-01/" itemprop="url">maven scope属性</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-06-11T22:28:35+08:00">
                2019-06-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/maven/" itemprop="url" rel="index">
                    <span itemprop="name">maven</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/06/11/maven-01/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/06/11/maven-01/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <table>
<thead>
<tr>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>compile</td>
<td>缺省值。适用于所有的阶段，随着项目一起发布</td>
</tr>
<tr>
<td>provided</td>
<td>该依赖不随项目发布而打包，由JDK或者容器来提供该依赖，例如Servlet API。</td>
</tr>
<tr>
<td>runtime</td>
<td>编译时不需要，运行时才需要，例如JDBC API Jar，编译时并不关注JDBC驱动的具体实现</td>
</tr>
<tr>
<td>test</td>
<td>编译和运行时不需要，仅仅在测试时需要</td>
</tr>
<tr>
<td>system</td>
<td>与provided类似，但需要显示的指定一个本地的JAR包文件路径。即解决依赖不是通过maven仓库，而是通过本地系统类库</td>
</tr>
</tbody>
</table>
<p><img src="/2019/06/11/maven-01/scope.png" alt="scope属性">  </p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><blockquote>
<p><a href="https://www.cnblogs.com/hzzll/p/6738955.html" target="_blank" rel="noopener">maven中scope属性</a></p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/uploads/avatar.jpeg"
                alt="小磊砸" />
            
              <p class="site-author-name" itemprop="name">小磊砸</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">64</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">22</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">47</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">小磊砸</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  

    
      <script id="dsq-count-scr" src="https://xiaoleiza.disqus.com/count.js" async></script>
    

    

  




	





  














  





  

  

  

  
  

  

  

  

</body>
</html>
